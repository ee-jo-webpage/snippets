<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8" />
    <title>스니펫 추가</title>
</head>

<body>
    <h1>스니펫 추가</h1>

    <form th:action="@{/snippets/new}"
          th:object="${snippet}"
          method="post"
          enctype="multipart/form-data">  <!-- enctype 추가 -->
        <table border="1">
            <tr>
                <th>Source URL</th>
                <td><input type="text" th:field="*{sourceurl}" /></td>
            </tr>

            <tr>
                <th>Type</th>
                <td>
                    <select th:field="*{type}" id="typeSelect" onchange="showFields()">
                        <option value="code">Code</option>
                        <option value="text">Text</option>
                        <option value="img">Image</option>
                    </select>
                </td>
            </tr>

            <tr>
                <th>Memo</th>
                <td><input type="text" th:field="*{memo}" /></td>
            </tr>

            <tr>
                <th>Visibility</th>
                <td>
                    <select th:field="*{visibility}">
                        <option value="1">Visible</option>
                        <option value="0">Hidden</option>
                    </select>
                </td>
            </tr>

            <!-- Code 타입일 때만 보임 -->
            <tr class="codeFields" style="display:none;">
                <th>Language</th>
                <td>
                    <select th:field="*{language}">
                        <option value="0">JAVA</option>
                        <option value="1">PYTHON</option>
                        <option value="2">C</option>
                    </select>
                </td>
            </tr>
            <tr class="codeFields" style="display:none;">
                <th>Code Content</th>
                <td><textarea th:field="*{codecontent}"></textarea></td>
            </tr>

            <!-- Text 타입일 때만 보임 -->
            <tr id="textFields" style="display:none;">
                <th>Text Content</th>
                <td><textarea th:field="*{textcontent}"></textarea></td>
            </tr>

            <!-- Image 타입일 때만 보임 -->
            <tr class="imageFields" style="display:none;">
                <th>이미지 파일</th>
                <td><input type="file" name="imageFile" accept="image/*" /></td>
            </tr>
            <tr class="imageFields" style="display:none;">
                <th>Alt Text</th>
                <td><input type="text" th:field="*{alttext}" /></td>
            </tr>
        </table>

        <button type="submit">스니펫 추가</button>
    </form>

    <a href="/snippets">← 목록으로 돌아가기</a>

    <script>
        function showFields() {
            const type = document.getElementById('typeSelect').value;
            document.querySelectorAll('.codeFields')
                    .forEach(el => el.style.display = (type === 'code') ? '' : 'none');
            document.getElementById('textFields')
                    .style.display = (type === 'text') ? '' : 'none';
            document.querySelectorAll('.imageFields')
                    .forEach(el => el.style.display = (type === 'img') ? '' : 'none');
        }
        window.onload = showFields;
    </script>

</body>

</html>
