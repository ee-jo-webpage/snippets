<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ìŠ¤ë‹ˆí« íƒœê·¸ ê´€ë¦¬</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link th:href="@{/tag/css/snippet-tags.css}" rel="stylesheet">
</head>
<body>
<div class="container">
    <!-- ì„¸ì…˜ ì •ë³´ í™•ì¸ íŒ¨ë„ ì¶”ê°€ -->
    <div class="session-panel">
        <button class="session-toggle-btn" onclick="toggleSessionInfo()">
            ğŸ” ì„¸ì…˜ ì •ë³´ í™•ì¸
        </button>
        <div id="sessionInfo" class="session-info">
            <div class="session-item">
                <span class="session-key">í˜„ì¬ ì‚¬ìš©ì ID:</span>
                <span class="session-value" th:text="${currentId != null ? currentId : 'ì—†ìŒ'}">ì—†ìŒ</span>
            </div>
            <div class="session-item">
                <span class="session-key">ì„¸ì…˜ ID:</span>
                <span class="session-value" id="sessionId">ë¡œë”© ì¤‘...</span>
            </div>
            <div class="session-item">
                <span class="session-key">ì„œë²„ ì„¸ì…˜ ë°ì´í„°:</span>
                <span class="session-value" id="serverSessionData">ë¡œë”© ì¤‘...</span>
            </div>
        </div>
    </div>

    <h1>ğŸ“ ìŠ¤ë‹ˆí« íƒœê·¸ ê´€ë¦¬</h1>

    <div class="search-bar">
        <input type="text"
               id="snippetSearch"
               class="search-input"
               placeholder="ìŠ¤ë‹ˆí« ê²€ìƒ‰ (ì œëª©, ë‚´ìš©, íƒœê·¸...)">
    </div>

    <div id="errorMessage" class="error" style="display: none;"></div>

    <div id="snippetsContainer" class="snippets-grid">
        <div class="loading">ìŠ¤ë‹ˆí«ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
    </div>
</div>

<!-- í”Œë¡œíŒ… ì•Œë¦¼ -->
<div id="toast" class="toast"></div>

    <script>
        // ì„¸ì…˜ ì •ë³´ í† ê¸€ í•¨ìˆ˜
        function toggleSessionInfo() {
            const sessionInfo = document.getElementById('sessionInfo');
            if (sessionInfo.style.display === 'none' || sessionInfo.style.display === '') {
                sessionInfo.style.display = 'block';
                loadSessionData();
            } else {
                sessionInfo.style.display = 'none';
            }
        }

        // ì„¸ì…˜ ë°ì´í„° ë¡œë“œ í•¨ìˆ˜
        async function loadSessionData() {
            try {
                // ì„¸ì…˜ ID ê°€ì ¸ì˜¤ê¸° (ì¿ í‚¤ì—ì„œ)
                const cookies = document.cookie.split(';');
                let sessionId = 'ì¿ í‚¤ì—ì„œ ì„¸ì…˜IDë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ';

                for (let cookie of cookies) {
                    const [name, value] = cookie.trim().split('=');
                    if (name === 'JSESSIONID' || name === 'connect.sid') {
                        sessionId = value;
                        break;
                    }
                }
                document.getElementById('sessionId').textContent = sessionId;

                // ì„œë²„ ì„¸ì…˜ ë°ì´í„° í™•ì¸ API í˜¸ì¶œ
                try {
                    const response = await fetch('/color/check-session');
                    if (response.ok) {
                        const sessionData = await response.json();
                        document.getElementById('serverSessionData').innerHTML =
                            `userId: ${sessionData.userId || 'ì—†ìŒ'}, ` +
                            `sessionId: ${sessionData.sessionId || 'ì—†ìŒ'}`;
                    } else {
                        document.getElementById('serverSessionData').textContent =
                            'API ì‘ë‹µ ì˜¤ë¥˜ - ì„œë²„ì—ì„œ í™•ì¸í•˜ì„¸ìš”';
                    }
                } catch (error) {
                    document.getElementById('serverSessionData').textContent =
                        `ì„¸ì…˜ í™•ì¸ API ì—†ìŒ - ${error.message}`;
                    console.log('ì„¸ì…˜ í™•ì¸ API í˜¸ì¶œ ì‹¤íŒ¨:', error);
                }
            } catch (error) {
                console.error('ì„¸ì…˜ ì •ë³´ ë¡œë“œ ì¤‘ ì˜¤ë¥˜:', error);
                document.getElementById('serverSessionData').textContent = 'ì˜¤ë¥˜ ë°œìƒ';
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ìœ¼ë¡œ ì„¸ì…˜ ì •ë³´ í‘œì‹œ (ê°œë°œ ë‹¨ê³„ì—ì„œë§Œ)
        document.addEventListener('DOMContentLoaded', function() {
            // ê°œë°œ ëª¨ë“œì—ì„œ ìë™ìœ¼ë¡œ ì„¸ì…˜ ì •ë³´ í‘œì‹œ
            // toggleSessionInfo();
        });
    </script>
<script th:src="@{/tag/js/snippet-tags.js}"></script>
</body>
</html>