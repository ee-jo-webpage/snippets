<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <title>스니펫 수정</title>
  <style>
    * { box-sizing: border-box; margin:0; padding:0; }
    body {
      background: #f0e9dd;
      display:flex; justify-content:center; align-items:start;
      padding:2rem; font-family:'Noto Sans KR',sans-serif;
    }
    .notepad {
      position: relative;
      width: 500px;
      background: #fbf6ec;
      border: 2px solid #ccc;
      border-radius: 6px;
      overflow: hidden;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      padding: 3rem 1.5rem 1.5rem;
      margin-bottom: 2rem;
    }
    .notepad::after {
      content:""; position:absolute; left:50%; top:0; transform:translateX(-50%);
      width:100%; height:2rem;
      background: repeating-linear-gradient(
        to right,
        transparent 0, transparent 20px,
        rgba(0,0,0,0.1) 20px, rgba(0,0,0,0.1) 22px
      );
      pointer-events:none; z-index:2;
    }
    .notepad::before {
      content:""; position:absolute; inset:0;
      background:
        repeating-linear-gradient(to bottom, rgba(0,0,0,0.04) 0, rgba(0,0,0,0.04) 1px, transparent 1px, transparent 32px),
        repeating-linear-gradient(to right, rgba(0,0,0,0.02) 0, rgba(0,0,0,0.02) 1px, transparent 1px, transparent 8px);
      pointer-events:none; z-index:1;
    }
    .notepad > * { position: relative; z-index:2; }

    h1 {
      margin-bottom: 1rem;
      font-size: 1.5rem;
      color: rgb(0, 0, 0);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 1rem;
      border: none;
    }
    table th, table td {
      border: none;
      padding: 0.5rem;
      background: transparent;
    }

    input[type="text"],
    textarea,
    select {
      width: 100%;
      padding: 0.4rem;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-family: inherit;
      font-size: 0.9rem;
      background: #fff;
      transition: background 0.2s;
    }
    .filled {
      background: transparent !important;
    }
    textarea {
      resize: vertical;
    }

    button {
      display: inline-block;
      padding: 0.5rem 1rem;
      background: #ccc;
      color: rgb(0, 0, 0);
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.9rem;
    }
    button:hover {
      background: #fbf6ec;
    }
    a.back {
      display: inline-block;
      margin-top: 0.5rem;
      color: #555;
      text-decoration: none;
      font-size: 0.9rem;
    }
    a.back:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <div class="notepad">
    <h1>스니펫 수정</h1>

    <form th:action="@{/snippets/edit/{snippetId}(snippetId=${snippet.snippetId})}"
          th:object="${snippet}"
          method="post"
          enctype="multipart/form-data">
      <table>
        <tr>
          <th>Source URL</th>
          <td><input type="text" th:field="*{sourceUrl}" /></td>
        </tr>
        <tr>
          <th>Type</th>
          <td>
            <select th:field="*{type}" id="typeSelect" onchange="showFields()">
              <option value="CODE" th:selected="${snippet.type.name() == 'CODE'}">Code</option>
              <option value="TEXT" th:selected="${snippet.type.name() == 'TEXT'}">Text</option>
              <option value="IMG" th:selected="${snippet.type.name() == 'IMG'}">Image</option>
            </select>
          </td>
        </tr>

        <!-- Code Content Field -->
        <tr id="codeContentField" th:style="${snippet.type.name() == 'CODE' ? '' : 'display:none;'}">
          <th>Code Content</th>
          <td>
            <textarea th:field="*{codeContent}" name="content" rows="6"></textarea> <!-- name을 content로 변경 -->
          </td>
        </tr>

        <!-- Text Content Field -->
        <tr id="textContentField" th:style="${snippet.type.name() == 'TEXT' ? '' : 'display:none;'}">
          <th>Text Content</th>
          <td>
            <textarea th:field="*{textContent}" name="content" rows="6"></textarea> <!-- name을 content로 변경 -->
          </td>
        </tr>

        <!-- Image Fields -->
        <tr id="imageFields" th:style="${snippet.type.name() == 'IMG' ? '' : 'display:none;'}">
          <th>이미지 파일</th>
          <td><input type="file" name="imageFile" accept="image/*" /></td>
        </tr>

        <!-- Alt Text for Image -->
        <tr id="altTextField" th:style="${snippet.type.name() == 'IMG' ? '' : 'display:none;'}">
          <th>Alt Text</th>
          <td><input type="text" th:field="*{altText}" /></td>
        </tr>

        <!-- Language Field for Code -->
        <tr id="languageField" th:style="${snippet.type.name() == 'CODE' ? '' : 'display:none;'}">
          <th>Language</th>
          <td>
            <select th:field="*{language}">
              <option value="JAVA" th:selected="${snippet.language == 'JAVA'}">JAVA</option>
              <option value="PYTHON" th:selected="${snippet.language == 'PYTHON'}">PYTHON</option>
              <option value="C" th:selected="${snippet.language == 'C'}">C</option>
            </select>
          </td>
        </tr>
      </table>

      <button type="submit">수정</button>
    </form>

    <a href="/snippets" class="back">← 목록으로 돌아가기</a>
  </div>

  <script>
    function showFields() {
      const type = document.getElementById('typeSelect').value;

      // Hide all fields before showing the selected ones and reset values
      resetValues();

      // Display the corresponding content fields
      document.getElementById('codeContentField').style.display = (type === 'CODE') ? '' : 'none';
      document.getElementById('textContentField').style.display = (type === 'TEXT') ? '' : 'none';
      document.getElementById('imageFields').style.display = (type === 'IMG') ? '' : 'none';
      document.getElementById('altTextField').style.display = (type === 'IMG') ? '' : 'none';
      document.getElementById('languageField').style.display = (type === 'CODE') ? '' : 'none';
    }

    function resetValues() {
      // Reset values for hidden fields
      document.querySelectorAll('#codeContentField textarea, #textContentField textarea, #altTextField input').forEach((el) => {
        el.value = ''; // Clear the value
      });
    }

    window.onload = showFields;

    document.querySelectorAll('input[type="text"], textarea, select').forEach(el => {
      const toggleFilled = () => {
        if (el.value && el.value.trim() !== '') el.classList.add('filled');
        else el.classList.remove('filled');
      };
      el.addEventListener('input', toggleFilled);
      toggleFilled();
    });
  </script>

</body>
</html>
