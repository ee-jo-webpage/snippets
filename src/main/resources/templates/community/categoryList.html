<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>커뮤니티</title>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">

    <style>
        * {
            box-sizing: border-box;
        }

        body {
            background-color: #f5f6f7;
            font-family: 'Malgun Gothic', '맑은 고딕', sans-serif;
            margin: 0;
            padding: 0;
            color: #333;
        }

        /* 헤더 스타일 */
        .community-header {
            background: linear-gradient(135deg, #00d084 0%, #33b5e5 100%);
            color: white;
            padding: 1rem 0;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .community-header h1 {
            margin: 0;
            font-size: 1.5rem;
            font-weight: 600;
        }

        .header-controls {
            display: flex;
            gap: 0.5rem;
            align-items: center;
            justify-content: flex-end; /* 오른쪽 정렬로 수정 */
        }

        .header-controls .btn {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
        }

        .header-controls .btn:hover {
            background-color: rgba(255, 255, 255, 0.2);
            transform: translateY(-1px);
        }

        /* 메인 컨테이너 */
        .main-container {
            display: flex;
            min-height: calc(100vh - 80px);
            max-width: 1200px;
            margin: 0 auto;
            gap: 0;
        }

        /* 사이드바 스타일 (네이버 카페 스타일) */
        .sidebar {
            width: 250px;
            background: white;
            border-right: 1px solid #e5e5e5;
            box-shadow: 2px 0 8px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 80px;
            height: calc(100vh - 80px);
            overflow-y: auto;
        }

        .sidebar-header {
            padding: 1.5rem 1rem 1rem;
            border-bottom: 1px solid #e5e5e5;
            background: #fafafa;
        }

        .sidebar-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #333;
            margin: 0;
        }

        /* 카테고리 메뉴 */
        .category-menu {
            padding: 0;
            margin: 0;
            background: white;
        }

        .category-item {
            border-bottom: 1px solid #f0f0f0;
        }

        .category-item:last-child {
            border-bottom: none;
        }

        .category-link {
            display: flex;
            align-items: center;
            padding: 1rem 1.5rem;
            color: #333;
            text-decoration: none;
            font-size: 0.95rem;
            transition: all 0.2s ease;
            position: relative;
        }

        .category-link:hover {
            background: #f8f9fa;
            color: #00d084;
            padding-left: 2rem;
        }

        .category-link.active {
            background: #e8f5e8;
            color: #00d084;
            font-weight: 600;
            border-right: 3px solid #00d084;
        }

        .category-icon {
            margin-right: 0.75rem;
            width: 16px;
            text-align: center;
        }

        .category-count {
            margin-left: auto;
            background: #e9ecef;
            color: #6c757d;
            font-size: 0.8rem;
            padding: 0.2rem 0.5rem;
            border-radius: 10px;
            min-width: 24px;
            text-align: center;
        }

        .category-link.active .category-count {
            background: #00d084;
            color: white;
        }

        /* 메인 콘텐츠 영역 */
        .main-content {
            flex: 1;
            background: white;
            padding: 0;
            min-height: calc(100vh - 80px);
        }

        /* 콘텐츠 헤더 */
        .content-header {
            padding: 1.5rem 2rem 1rem;
            border-bottom: 2px solid #f0f0f0;
            background: linear-gradient(to right, #fafafa, #ffffff);
        }

        .content-title {
            font-size: 1.4rem;
            font-weight: 600;
            color: #333;
            margin: 0 0 0.5rem;
        }

        .content-subtitle {
            color: #666;
            font-size: 0.9rem;
            margin: 0;
        }

        .content-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .btn-write {
            background: linear-gradient(135deg, #00d084, #33b5e5);
            color: white;
            border: none;
            padding: 0.6rem 1.5rem;
            border-radius: 20px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .btn-write:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 208, 132, 0.3);
            color: white;
        }

        .btn-search {
            background: white;
            color: #666;
            border: 1px solid #ddd;
            padding: 0.6rem 1.5rem;
            border-radius: 20px;
            transition: all 0.3s ease;
        }

        .btn-search:hover {
            background: #f8f9fa;
            border-color: #00d084;
            color: #00d084;
        }

        /* 게시글 목록 스타일 */
        .post-list {
            padding: 0;
        }

        .post-item {
            display: flex;
            align-items: center;
            padding: 1rem 2rem;
            border-bottom: 1px solid #f0f0f0;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .post-item:hover {
            background: #f8f9fa;
        }

        .post-item.notice {
            background: #fff8e1;
            border-left: 4px solid #ff9800;
        }

        .post-item.notice:hover {
            background: #fff3c4;
        }

        .post-number {
            width: 60px;
            text-align: center;
            font-size: 0.9rem;
            color: #999;
            flex-shrink: 0;
        }

        .notice-badge {
            background: linear-gradient(135deg, #ff9800, #f57c00);
            color: white;
            padding: 0.3rem 0.8rem;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
            display: inline-block; /* 공지 배지 수정 */
        }

        .post-content {
            flex: 1;
            margin: 0 1rem;
            min-width: 0;
        }

        .post-title {
            font-size: 1rem;
            font-weight: 500;
            color: #333;
            margin: 0 0 0.3rem;
            line-height: 1.4;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .post-item:hover .post-title {
            color: #00d084;
        }

        .post-meta {
            font-size: 0.85rem;
            color: #888;
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .post-meta span {
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        .post-stats {
            display: flex;
            gap: 1rem;
            align-items: center;
            flex-shrink: 0;
            font-size: 0.85rem;
            color: #666;
        }

        .post-stat {
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        .comment-count {
            background: #00d084;
            color: white;
            padding: 0.2rem 0.6rem;
            border-radius: 10px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .new-badge {
            background: #dc3545;
            color: white;
            padding: 0.1rem 0.4rem;
            border-radius: 8px;
            font-size: 0.7rem;
            font-weight: 600;
            margin-left: 0.5rem;
        }

        /* 빈 상태 */
        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: #999;
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: #ddd;
        }

        /* 검색 모달 */
        .search-modal .modal-dialog {
            max-width: 600px;
        }

        .search-form {
            padding: 1rem;
        }

        .search-form .form-control {
            border-radius: 8px;
            border: 1px solid #ddd;
            padding: 0.75rem;
        }

        .search-form .form-control:focus {
            border-color: #00d084;
            box-shadow: 0 0 0 0.2rem rgba(0, 208, 132, 0.25);
        }

        .search-form .btn-primary {
            background: #00d084;
            border-color: #00d084;
            border-radius: 8px;
            padding: 0.75rem 1.5rem;
        }

        /* 페이지네이션 */
        .pagination-container {
            padding: 2rem;
            text-align: center;
            border-top: 1px solid #f0f0f0;
            background: #fafafa;
        }

        .pagination {
            justify-content: center;
            margin: 0;
        }

        .pagination .page-link {
            color: #666;
            border: 1px solid #ddd;
            margin: 0 0.2rem;
            border-radius: 6px;
        }

        .pagination .page-item.active .page-link {
            background: #00d084;
            border-color: #00d084;
        }

        .pagination .page-link:hover {
            color: #00d084;
            border-color: #00d084;
        }

        /* 반응형 디자인 */
        @media (max-width: 768px) {
            .main-container {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                height: auto;
                position: static;
                border-right: none;
                border-bottom: 1px solid #e5e5e5;
            }

            .category-menu {
                display: flex;
                overflow-x: auto;
                padding: 0.5rem 0;
            }

            .category-item {
                border-bottom: none;
                border-right: 1px solid #f0f0f0;
                flex-shrink: 0;
            }

            .category-link {
                padding: 0.75rem 1rem;
                white-space: nowrap;
            }

            .post-item {
                padding: 1rem;
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem;
            }

            .post-number {
                width: auto;
                text-align: left;
            }

            .post-content {
                margin: 0;
                width: 100%;
            }

            .post-stats {
                align-self: flex-end;
            }

            .content-header {
                padding: 1rem;
            }

            .content-actions {
                flex-direction: column;
            }
        }

        /* 스크롤바 커스텀 */
        .sidebar::-webkit-scrollbar {
            width: 6px;
        }

        .sidebar::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        .sidebar::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 3px;
        }

        .sidebar::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
    </style>
</head>
<body>
<!-- 헤더 -->
<div class="community-header">
    <div class="container-fluid">
        <div class="row align-items-center">
            <div class="col-md-6">
                <h1>
                    <i class="fas fa-comments me-2"></i>
                    커뮤니티
                </h1>
            </div>
            <div class="col-md-6 text-md-end">
                <div class="header-controls">
                    <!-- 알림 버튼 -->
                    <button class="btn btn-outline-light position-relative" id="notificationBtn">
                        <i class="fas fa-bell"></i>
                        <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger"
                              id="notificationCount" style="display: none;">0</span>
                    </button>

                    <!-- 임시저장 버튼 -->
                    <button class="btn btn-outline-light" id="draftBtn">
                        <i class="fas fa-save me-1"></i>
                        임시저장
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 메인 컨테이너 -->
<div class="main-container">
    <!-- 사이드바 -->
    <div class="sidebar">
        <div class="sidebar-header">
            <h3 class="sidebar-title">게시판</h3>
        </div>
        <nav class="category-menu">
            <!-- 전체 게시글 -->
            <div class="category-item">
                <a class="category-link" data-category="all" href="/community/posts/all"
                   th:classappend="${currentCategoryId == 'all'} ? 'active' : ''">
                    <i class="fas fa-home category-icon"></i>
                    전체 게시글
                    <span class="category-count">123</span>
                </a>
            </div>

            <!-- 카테고리 목록 (서버에서 동적으로 생성) -->
            <div class="category-item" th:each="category : ${categories}">
                <a class="category-link"
                   th:classappend="${currentCategoryId == category.categoryId} ? 'active' : ''"
                   th:data-category="${category.categoryId}"
                   th:href="@{/community(categoryId=${category.categoryId})}">
                    <i class="fas fa-folder category-icon"></i>
                    <span th:text="${category.name}">카테고리명</span>
                    <span class="category-count">42</span>
                </a>
            </div>
        </nav>
    </div>

    <!-- 메인 콘텐츠 -->
    <div class="main-content">
        <!-- 콘텐츠 헤더 -->
        <div class="content-header">
            <h2 class="content-title" th:text="${currentCategoryName ?: '자유게시판'}">자유게시판</h2>
            <p class="content-subtitle" id="categoryDescription">
                <span th:if="${currentCategoryId == 'all'}">모든 게시판의 글을 한 번에 볼 수 있습니다.</span>
                <span th:if="${currentCategoryId == 1}">자유롭게 이야기를 나누는 공간입니다.</span>
                <span th:if="${currentCategoryId == 2}">궁금한 것들을 질문하고 답변받는 공간입니다.</span>
                <span th:if="${currentCategoryId == 3}">유용한 팁과 노하우를 공유하는 공간입니다.</span>
                <span th:if="${currentCategoryId == 4}">중요한 공지사항을 확인할 수 있습니다.</span>
                <span th:unless="${currentCategoryId == 'all' or currentCategoryId == 1 or currentCategoryId == 2 or currentCategoryId == 3 or currentCategoryId == 4}">게시글을 확인하세요.</span>
            </p>
            <div class="content-actions">
                <button class="btn btn-write"
                        th:onclick="|location.href='/community/post/new?categoryId=${currentCategoryId}'|">
                    <i class="fas fa-edit me-1"></i>
                    글쓰기
                </button>
                <button class="btn btn-search" data-bs-target="#searchModal" data-bs-toggle="modal">
                    <i class="fas fa-search me-1"></i>
                    검색
                </button>
            </div>
        </div>

        <!-- 게시글 목록 -->
        <div class="post-list" id="postList">
            <!-- 게시글이 있는 경우 -->
            <div th:if="${not #lists.isEmpty(posts)}">
                <div class="post-item"
                     th:classappend="${post.notice} ? 'notice' : ''"
                     th:each="post : ${posts}"
                     th:onclick="|location.href='/community/post/${post.postId}'|">
                    <div class="post-number">
                            <span class="notice-badge" th:if="${post.notice}">
                                <i class="fas fa-bullhorn me-1"></i>공지
                            </span>
                        <span th:text="${post.postId}" th:unless="${post.notice}">1</span>
                    </div>
                    <div class="post-content">
                        <div class="post-title">
                            <span th:text="${post.title}">게시글 제목입니다</span>
                            <span class="new-badge"
                                  th:if="${#temporals.createNow().minusDays(1).isBefore(post.createdAt)}">NEW</span>
                        </div>
                        <div class="post-meta">
                            <span><i class="fas fa-user"></i><span th:text="${post.nickname}">작성자</span></span>
                            <span><i class="fas fa-calendar"></i><span
                                    th:text="${#temporals.format(post.createdAt, 'MM-dd HH:mm')}">01-15 14:30</span></span>
                            <span class="badge bg-secondary" th:if="${post.categoryName}"
                                  th:text="${post.categoryName}">카테고리</span>
                        </div>
                    </div>
                    <div class="post-stats">
                        <div class="post-stat">
                            <i class="fas fa-eye"></i>
                            <span th:text="${post.viewCount}">42</span>
                        </div>
                        <div class="post-stat" th:if="${post.commentCount != null and post.commentCount != '0'}">
                            <span class="comment-count" th:text="${post.commentCount}">3</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 빈 상태 (게시글이 없을 때) -->
            <div class="empty-state" th:if="${#lists.isEmpty(posts)}">
                <i class="fas fa-inbox"></i>
                <h4>게시글이 없습니다</h4>
                <p>첫 번째 게시글을 작성해보세요!</p>
                <button class="btn btn-write"
                        th:onclick="|location.href='/community/post/new?categoryId=${currentCategoryId}'|">
                    <i class="fas fa-edit me-1"></i>
                    글쓰기
                </button>
            </div>
        </div>

        <!-- 페이지네이션 -->
        <div class="pagination-container" th:if="${not #lists.isEmpty(posts)}">
            <nav aria-label="Page navigation">
                <ul class="pagination">
                    <li class="page-item disabled">
                        <a class="page-link" href="#" tabindex="-1">
                            <i class="fas fa-chevron-left"></i>
                        </a>
                    </li>
                    <li class="page-item active">
                        <a class="page-link" href="#">1</a>
                    </li>
                    <li class="page-item">
                        <a class="page-link" href="#">2</a>
                    </li>
                    <li class="page-item">
                        <a class="page-link" href="#">3</a>
                    </li>
                    <li class="page-item">
                        <a class="page-link" href="#">
                            <i class="fas fa-chevron-right"></i>
                        </a>
                    </li>
                </ul>
            </nav>
        </div>
    </div>
</div>

<!-- 검색 모달 -->
<div class="modal fade search-modal" id="searchModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-search me-2"></i>
                    게시글 검색
                </h5>
                <button class="btn-close" data-bs-dismiss="modal" type="button"></button>
            </div>
            <div class="modal-body">
                <form action="/community/search" class="search-form" method="get">
                    <div class="mb-3">
                        <label class="form-label">검색 유형</label>
                        <select class="form-select" name="searchType">
                            <option value="titleContent">제목+내용</option>
                            <option value="title">제목만</option>
                            <option value="content">내용만</option>
                            <option value="writer">작성자</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">검색어</label>
                        <input class="form-control" name="keyword" placeholder="검색어를 입력하세요" type="text">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">카테고리</label>
                        <select class="form-select" name="categoryId">
                            <option value="">전체 카테고리</option>
                            <option th:each="category : ${categories}"
                                    th:text="${category.name}"
                                    th:value="${category.categoryId}"></option>
                        </select>
                    </div>
                    <div class="d-grid">
                        <button class="btn btn-primary" type="submit">
                            <i class="fas fa-search me-1"></i>
                            검색
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- 알림 모달 -->
<div class="modal fade" id="notificationModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-bell me-2"></i>
                    알림
                </h5>
                <button class="btn-close" data-bs-dismiss="modal" type="button"></button>
            </div>
            <div class="modal-body" style="max-height: 400px; overflow-y: auto;">
                <div id="notificationList">
                    <div class="text-center py-4">
                        <i class="fas fa-spinner fa-spin"></i>
                        알림을 불러오는 중...
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline-secondary" id="markAllReadBtn" type="button">
                    <i class="fas fa-check-double me-1"></i>
                    모두 읽음 처리
                </button>
                <button class="btn btn-secondary" data-bs-dismiss="modal" type="button">닫기</button>
            </div>
        </div>
    </div>
</div>

<!-- 임시저장 모달 -->
<div class="modal fade" id="draftModal" tabindex="-1">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-save me-2"></i>
                    임시저장 목록
                </h5>
                <button class="btn-close" data-bs-dismiss="modal" type="button"></button>
            </div>
            <div class="modal-body" style="max-height: 500px; overflow-y: auto;">
                <div id="draftList">
                    <div class="text-center py-4">
                        <i class="fas fa-spinner fa-spin"></i>
                        임시저장 목록을 불러오는 중...
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-bs-dismiss="modal" type="button">닫기</button>
            </div>
        </div>
    </div>
</div>

<script th:inline="javascript">
    /*<![CDATA[*/
    const currentCategoryId = /*[[${currentCategoryId}]]*/ 1;
    const currentCategoryName = /*[[${currentCategoryName}]]*/ '자유게시판';
    /*]]>*/

    $(document).ready(function () {
        console.log('현재 카테고리 ID:', currentCategoryId);
        console.log('현재 카테고리 이름:', currentCategoryName);

        // 알림 관련 이벤트
        $('#notificationBtn').click(function () {
            loadNotifications();
            $('#notificationModal').modal('show');
        });

        $('#draftBtn').click(function () {
            loadDrafts();
            $('#draftModal').modal('show');
        });

        $('#markAllReadBtn').click(function () {
            markAllNotificationsAsRead();
        });

        // 초기 로드
        loadNotificationCount();
    });

    // 알림 개수 로드
    function loadNotificationCount() {
        $.ajax({
            url: '/api/community/notification/unread-count',
            type: 'GET',
            success: function (response) {
                if (response.unreadCount > 0) {
                    $('#notificationCount').text(response.unreadCount).show();
                } else {
                    $('#notificationCount').hide();
                }
            },
            error: function () {
                console.log('알림 개수 로드 실패');
            }
        });
    }

    // 알림 목록 로드
    function loadNotifications() {
        $.ajax({
            url: '/api/community/notification/list',
            type: 'GET',
            success: function (response) {
                renderNotifications(response.notifications);
            },
            error: function () {
                $('#notificationList').html('<div class="text-center text-danger">알림을 불러올 수 없습니다.</div>');
            }
        });
    }

    // 유틸리티 함수들
    function getNotificationIcon(type) {
        switch (type) {
            case 'new_comment':
                return 'fas fa-comment text-primary';
            case 'new_reply':
                return 'fas fa-reply text-info';
            case 'comment_like':
                return 'fas fa-heart text-danger';
            default:
                return 'fas fa-bell text-secondary';
        }
    }

    function getNotificationMessage(notification) {
        switch (notification.type) {
            case 'new_comment':
                return '회원님의 게시글에 새 댓글이 달렸습니다.';
            case 'new_reply':
                return '회원님의 댓글에 답글이 달렸습니다.';
            case 'comment_like':
                return '회원님의 댓글에 좋아요가 눌렸습니다.';
            default:
                return '새로운 알림이 있습니다.';
        }
    }

    function formatDate(dateString) {
        const date = new Date(dateString);
        const now = new Date();
        const diff = now - date;

        if (diff < 60000) return '방금 전';
        if (diff < 3600000) return Math.floor(diff / 60000) + '분 전';
        if (diff < 86400000) return Math.floor(diff / 3600000) + '시간 전';

        return date.toLocaleDateString();
    }

    function truncateText(text, length) {
        if (!text) return '';
        return text.length > length ? text.substring(0, length) + '...' : text;
    }


    // 개별 알림 읽음 처리
    $(document).on('click', '.mark-read-btn', function () {
        const notificationId = $(this).data('id');

        $.ajax({
            url: `/api/community/notification/read/${notificationId}`,
            type: 'POST',
            success: function (response) {
                if (response.success) {
                    loadNotifications();
                    loadNotificationCount();
                }
            }
        });
    });

    // 임시저장 수정
    function editDraft(draftId) {
        window.location.href = `/community/post/new?draftId=${draftId}`;
    }

    // 임시저장 삭제
    function deleteDraft(draftId) {
        if (confirm('정말 삭제하시겠습니까?')) {
            $.ajax({
                url: `/api/community/draft/${draftId}`,
                type: 'DELETE',
                success: function (response) {
                    if (response.success) {
                        loadDrafts();
                    }
                }
            });
        }
    }    // 임시저장 렌더링
    function renderDrafts(drafts) {
        let html = '';

        if (drafts.length === 0) {
            html = '<div class="text-center py-4 text-muted">임시저장된 글이 없습니다.</div>';
        } else {
            drafts.forEach(function (draft) {
                html += `
    <div class="card mb-3">
        <div class="card-body">
            <div class="d-flex justify-content-between align-items-start">
                <div class="flex-grow-1">
                    <h6 class="card-title">${draft.title || '(제목 없음)'}</h6>
                    <p class="card-text text-muted">${truncateText(draft.content, 100)}</p>
                    <small class="text-muted">
                        <i class="fas fa-clock me-1"></i>
                        ${formatDate(draft.updatedAt)}
                    </small>
                </div>
                <div class="ms-3">
                    <button class="btn btn-sm btn-primary me-2" onclick="editDraft(${draft.draftId})">
                        <i class="fas fa-edit me-1"></i>
                        수정
                    </button>
                    <button class="btn btn-sm btn-danger" onclick="deleteDraft(${draft.draftId})">
                        <i class="fas fa-trash me-1"></i>
                        삭제
                    </button>
                </div>
            </div>
        </div>
    </div>
    `;
            });
        }

        $('#draftList').html(html);
    }

    // 모든 알림 읽음 처리
    function markAllNotificationsAsRead() {
        $.ajax({
            url: '/api/community/notification/read-all',
            type: 'POST',
            success: function (response) {
                if (response.success) {
                    loadNotifications();
                    loadNotificationCount();
                }
            }
        });
    }    // 알림 렌더링
    function renderNotifications(notifications) {
        let html = '';

        if (notifications.length === 0) {
            html = '<div class="text-center py-4 text-muted">새로운 알림이 없습니다.</div>';
        } else {
            notifications.forEach(function (notification) {
                const unreadClass = !notification.read ? 'bg-light' : '';
                const icon = getNotificationIcon(notification.type);
                const message = getNotificationMessage(notification);

                html += `
    <div class="notification-item ${unreadClass} p-3 border-bottom" data-id="${notification.notificationId}">
        <div class="d-flex align-items-start">
            <div class="me-3">
                <i class="${icon}"></i>
            </div>
            <div class="flex-grow-1">
                <div class="fw-bold">${notification.senderNickname || '시스템'}</div>
                <div class="text-muted">${message}</div>
                <small class="text-muted">${formatDate(notification.createdAt)}</small>
            </div>
            <div>
                <button class="btn btn-sm btn-outline-primary mark-read-btn" data-id="${notification.notificationId}">
                    <i class="fas fa-check"></i>
                </button>
            </div>
        </div>
    </div>
    `;
            });
        }

        $('#notificationList').html(html);
    }

    // 임시저장 목록 로드
    function loadDrafts() {
        $.ajax({
            url: '/api/community/draft/list',
            type: 'GET',
            success: function (response) {
                renderDrafts(response.drafts);
            },
            error: function () {
                $('#draftList').html('<div class="text-center text-danger">임시저장 목록을 불러올 수 없습니다.</div>');
            }
        });
    }

</script>
</body>
</html>