<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê²Œì‹œê¸€ ì‘ì„±</title>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- ê¸°ë³¸ Summernote -->
    <link href="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote-bs4.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote-bs4.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/lang/summernote-ko-KR.min.js"></script>

    <!-- ì¶”ê°€ í”ŒëŸ¬ê·¸ì¸ë“¤ (ì„ íƒì‚¬í•­) -->
    <!-- ì´ëª¨ì§€ í”ŒëŸ¬ê·¸ì¸ -->
    <script src="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/plugin/summernote-ext-emoji.js"></script>

    <!-- íŠ¹ìˆ˜ë¬¸ì í”ŒëŸ¬ê·¸ì¸ -->
    <script src="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/plugin/summernote-ext-specialchars.js"></script>

    <!-- ìˆ˜ì‹ ì…ë ¥ í”ŒëŸ¬ê·¸ì¸ (MathJax) -->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>


    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <!-- Custom CSS (ì¸ë¼ì¸ìœ¼ë¡œ í¬í•¨) -->
    <style>
        /* ê²Œì‹œíŒ ê³µí†µ ìŠ¤íƒ€ì¼ */
        body {
            background-color: #f8f9fa;
            color: #333;
        }

        .card {
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            border: none;
        }


        /* ê¸°ì¡´ Summernote ìŠ¤íƒ€ì¼ë“¤... */
         .note-editor {
             border: 1px solid #dee2e6;
         }

        .note-toolbar {
            background-color: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
            padding: 0.5rem;
        }

        /* ë“œë¡­ë‹¤ìš´ ìŠ¤íƒ€ì¼ë“¤... (ê¸°ì¡´ê³¼ ë™ì¼) */
        .note-dropdown-menu {
            display: none;
            position: absolute;
            z-index: 1050;
            background-color: #fff;
            border: 1px solid #dee2e6;
            border-radius: 0.375rem;
            box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
            padding: 0.5rem 0;
            margin: 0.125rem 0 0;
            max-height: 300px;
            overflow-y: auto;
            min-width: 120px;
        }

        .note-dropdown-menu.show {
            display: block;
        }

        /* ğŸ”¥ ëª¨ë‹¬ ë‹¤ì´ì–¼ë¡œê·¸ ë‹«ê¸° ë²„íŠ¼ ìˆ˜ì • */
        .note-modal {
            z-index: 2050 !important;
            position: fixed !important;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .note-modal-content {
            background-color: #fff;
            border-radius: 0.5rem;
            box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.3);
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            margin: 2rem;
        }

        /* ëª¨ë‹¬ í—¤ë” */
        .note-modal-header {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid #dee2e6;
            display: flex;
            align-items: center;
            justify-content: space-between;
            background-color: #f8f9fa;
            border-radius: 0.5rem 0.5rem 0 0;
        }

        .note-modal-title {
            margin: 0;
            font-size: 1.25rem;
            font-weight: 500;
            color: #212529;
        }

        /* ğŸ”¥ ë‹«ê¸° ë²„íŠ¼ ìŠ¤íƒ€ì¼ ê°œì„  */
        .note-modal-header .close,
        .note-modal-header .btn-close,
        .note-modal-header button[data-dismiss="modal"],
        .note-modal-header button[aria-label="Close"] {
            background: transparent !important;
            border: none !important;
            font-size: 1.5rem !important;
            font-weight: bold !important;
            color: #6c757d !important;
            cursor: pointer !important;
            padding: 0.25rem !important;
            margin: 0 !important;
            width: 2rem !important;
            height: 2rem !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            border-radius: 0.25rem !important;
            transition: all 0.2s ease !important;
        }

        .note-modal-header .close:hover,
        .note-modal-header .btn-close:hover,
        .note-modal-header button[data-dismiss="modal"]:hover,
        .note-modal-header button[aria-label="Close"]:hover {
            background-color: #e9ecef !important;
            color: #212529 !important;
            transform: scale(1.1) !important;
        }

        /* ë‹«ê¸° ë²„íŠ¼ ë‚´ìš© (Ã—) */
        .note-modal-header .close::before,
        .note-modal-header button[data-dismiss="modal"]::before,
        .note-modal-header button[aria-label="Close"]::before {
            content: "Ã—" !important;
            font-size: 1.5rem !important;
            line-height: 1 !important;
        }

        /* ëª¨ë‹¬ ë°”ë”” */
        .note-modal-body {
            padding: 1.5rem;
        }

        /* ëª¨ë‹¬ í‘¸í„° */
        .note-modal-footer {
            padding: 1rem 1.5rem;
            border-top: 1px solid #dee2e6;
            display: flex;
            justify-content: flex-end;
            gap: 0.5rem;
            background-color: #f8f9fa;
            border-radius: 0 0 0.5rem 0.5rem;
        }

        /* ë§í¬ ë‹¤ì´ì–¼ë¡œê·¸ íŠ¹ë³„ ì²˜ë¦¬ */
        .note-link-dialog .note-modal-content,
        .note-image-dialog .note-modal-content,
        .note-video-dialog .note-modal-content {
            min-width: 400px;
        }

        /* í¼ ì»¨íŠ¸ë¡¤ ìŠ¤íƒ€ì¼ */
        .note-modal .form-control {
            display: block;
            width: 100%;
            padding: 0.5rem 0.75rem;
            font-size: 1rem;
            font-weight: 400;
            line-height: 1.5;
            color: #212529;
            background-color: #fff;
            border: 1px solid #ced4da;
            border-radius: 0.25rem;
            transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
        }

        .note-modal .form-control:focus {
            color: #212529;
            background-color: #fff;
            border-color: #86b7fe;
            outline: 0;
            box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
        }

        /* ëª¨ë‹¬ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .note-modal .btn {
            display: inline-block;
            padding: 0.5rem 1rem;
            font-size: 1rem;
            font-weight: 400;
            line-height: 1.5;
            color: #212529;
            text-align: center;
            text-decoration: none;
            vertical-align: middle;
            cursor: pointer;
            user-select: none;
            background-color: transparent;
            border: 1px solid transparent;
            border-radius: 0.25rem;
            transition: all 0.15s ease-in-out;
        }

        .note-modal .btn-primary {
            color: #fff;
            background-color: #0d6efd;
            border-color: #0d6efd;
        }

        .note-modal .btn-primary:hover {
            background-color: #0b5ed7;
            border-color: #0a58ca;
        }

        .note-modal .btn-secondary {
            color: #fff;
            background-color: #6c757d;
            border-color: #6c757d;
        }

        .note-modal .btn-secondary:hover {
            background-color: #5c636a;
            border-color: #565e64;
        }

        /* ë°˜ì‘í˜• ëª¨ë‹¬ */
        @media (max-width: 576px) {
            .note-modal-content {
                margin: 1rem;
                width: calc(100% - 2rem);
                min-width: unset;
            }

            .note-modal-header,
            .note-modal-body,
            .note-modal-footer {
                padding: 1rem;
            }
        }

        /* í¼ ìŠ¤íƒ€ì¼ */
        .form-label {
            font-weight: 500;
        }

        .form-control:focus {
            border-color: #0d6efd;
            box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, 0.25);
        }

        /* ìë™ì €ì¥ ìƒíƒœ */
        .auto-save-status {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #28a745;
            color: white;
            padding: 10px 15px;
            border-radius: 5px;
            font-size: 0.875rem;
            z-index: 1000;
            display: none;
        }

        .auto-save-status.saving {
            background: #ffc107;
            color: #212529;
        }

        .auto-save-status.error {
            background: #dc3545;
        }

        /* ì„ì‹œì €ì¥ ê´€ë ¨ ìŠ¤íƒ€ì¼ */
        .draft-item {
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            background: white;
            transition: box-shadow 0.2s ease;
        }

        .draft-item:hover {
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .draft-meta {
            font-size: 0.875rem;
            color: #6c757d;
        }

        /* ê¸°ëŠ¥ ë²„íŠ¼ */
        .feature-btn {
            border-radius: 8px;
            padding: 0.5rem 1rem;
            margin: 0.25rem;
            transition: all 0.3s ease;
        }

        .feature-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        /* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        .modal-content {
            border: none;
            border-radius: 15px;
        }

        .modal-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px 15px 0 0;
        }

        /* íŒŒì¼ ì—…ë¡œë“œ ìŠ¤íƒ€ì¼ */
        .file-upload-area {
            border: 2px dashed #dee2e6;
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
            transition: border-color 0.3s ease;
        }

        .file-upload-area:hover {
            border-color: #0d6efd;
        }

        .file-upload-area.dragover {
            border-color: #0d6efd;
            background-color: #e3f2fd;
        }


    </style>
</head>
<body>
<!-- ìë™ì €ì¥ ìƒíƒœ í‘œì‹œ -->
<div id="autoSaveStatus" class="auto-save-status">
    <i class="fas fa-save me-2"></i>
    <span id="autoSaveText">ìë™ì €ì¥ë¨</span>
</div>

<div class="container mt-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1>
            <i class="fas fa-edit me-2"></i>
            ê²Œì‹œê¸€ ì‘ì„±
        </h1>
        <div>
            <a href="/community" class="btn btn-outline-secondary me-2">
                <i class="fas fa-home me-1"></i>
                ë©”ì¸ìœ¼ë¡œ
            </a>
            <button type="button" id="draftListBtn" class="btn btn-outline-info">
                <i class="fas fa-save me-1"></i>
                ì„ì‹œì €ì¥ ëª©ë¡
            </button>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-9">
            <div class="card">
                <div class="card-body">
                    <form id="postForm" th:action="@{/community/post/new}" method="post" enctype="multipart/form-data">
                        <input type="hidden" id="draftId" name="draftId" value="">

                        <div class="mb-3">
                            <label for="categoryId" class="form-label">
                                <i class="fas fa-folder me-1"></i>
                                ì¹´í…Œê³ ë¦¬ <span class="text-danger">*</span>
                            </label>
                            <select id="categoryId" name="categoryId" class="form-select" required>
                                <option value="">ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                                <option th:each="category : ${categories}"
                                        th:value="${category.categoryId}"
                                        th:text="${category.name}"
                                        th:selected="${param.categoryId != null && param.categoryId[0] == category.categoryId.toString()}"></option>
                            </select>
                        </div>

                        <div class="mb-3">
                            <label for="title" class="form-label">
                                <i class="fas fa-heading me-1"></i>
                                ì œëª© <span class="text-danger">*</span>
                            </label>
                            <input type="text" id="title" name="title" class="form-control"
                                   placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”" required>
                        </div>

                        <div class="mb-3">
                            <label for="summernote" class="form-label">
                                <i class="fas fa-align-left me-1"></i>
                                ë‚´ìš© <span class="text-danger">*</span>
                            </label>
                            <textarea id="summernote" name="content"></textarea>
                        </div>

                        <div class="mb-3">
                            <label for="files" class="form-label">
                                <i class="fas fa-paperclip me-1"></i>
                                ì²¨ë¶€íŒŒì¼
                            </label>
                            <div class="file-upload-area" id="fileUploadArea">
                                <i class="fas fa-cloud-upload-alt fa-2x mb-2 text-muted"></i>
                                <p class="mb-2">íŒŒì¼ì„ ë“œë˜ê·¸í•˜ì—¬ ì—…ë¡œë“œí•˜ê±°ë‚˜ í´ë¦­í•˜ì—¬ ì„ íƒí•˜ì„¸ìš”</p>
                                <input type="file" id="files" name="files" multiple class="form-control"
                                       accept=".jpg,.jpeg,.png,.gif,.pdf,.doc,.docx,.hwp,.txt">
                                <small class="text-muted">ìµœëŒ€ 10MB, ì—¬ëŸ¬ íŒŒì¼ ì„ íƒ ê°€ëŠ¥</small>
                            </div>
                            <div id="fileList" class="mt-2"></div>
                        </div>

                        <div class="mb-3 form-check">
                            <input type="checkbox" id="isNotice" name="isNotice" class="form-check-input" value="true">
                            <label for="isNotice" class="form-check-label">
                                <i class="fas fa-exclamation-triangle me-1"></i>
                                ê³µì§€ì‚¬í•­ìœ¼ë¡œ ë“±ë¡
                            </label>
                        </div>

                        <div class="d-flex justify-content-between">
                            <div>
                                <button type="button" id="saveAsDraft" class="btn btn-outline-secondary feature-btn">
                                    <i class="fas fa-save me-1"></i>
                                    ì„ì‹œì €ì¥
                                </button>
                                <button type="button" id="previewBtn" class="btn btn-outline-info feature-btn">
                                    <i class="fas fa-eye me-1"></i>
                                    ë¯¸ë¦¬ë³´ê¸°
                                </button>
                            </div>

                            <div>
                                <button type="button" class="btn btn-secondary me-2" onclick="confirmCancel()">
                                    <i class="fas fa-times me-1"></i>
                                    ì·¨ì†Œ
                                </button>
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-paper-plane me-1"></i>
                                    ë“±ë¡
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- ì‚¬ì´ë“œë°” -->
        <div class="col-lg-3">
            <!-- ì‘ì„± ë„ì›€ë§ -->
            <div class="card mb-3">
                <div class="card-header">
                    <h6 class="mb-0">
                        <i class="fas fa-lightbulb me-1"></i>
                        ì‘ì„± ë„ì›€ë§
                    </h6>
                </div>
                <div class="card-body">
                    <ul class="list-unstyled mb-0 small">
                        <li class="mb-2">
                            <i class="fas fa-check text-success me-1"></i>
                            30ì´ˆë§ˆë‹¤ ìë™ì €ì¥ë©ë‹ˆë‹¤
                        </li>
                        <li class="mb-2">
                            <i class="fas fa-check text-success me-1"></i>
                            ì´ë¯¸ì§€ëŠ” ë“œë˜ê·¸&ë“œë¡­ìœ¼ë¡œ ì—…ë¡œë“œ ê°€ëŠ¥
                        </li>
                        <li class="mb-2">
                            <i class="fas fa-check text-success me-1"></i>
                            Ctrl+Enterë¡œ ë¹ ë¥¸ ë“±ë¡
                        </li>
                        <li class="mb-0">
                            <i class="fas fa-check text-success me-1"></i>
                            ì„ì‹œì €ì¥ì€ ìµœëŒ€ 10ê°œê¹Œì§€ ë³´ê´€
                        </li>
                    </ul>
                </div>
            </div>

            <!-- ìµœê·¼ ì‘ì„± ê¸€ -->
            <div class="card">
                <div class="card-header">
                    <h6 class="mb-0">
                        <i class="fas fa-history me-1"></i>
                        ìµœê·¼ ì‘ì„±ê¸€
                    </h6>
                </div>
                <div class="card-body">
                    <div id="recentPosts" class="small">
                        <div class="text-center text-muted">
                            <i class="fas fa-spinner fa-spin"></i>
                            ë¡œë”© ì¤‘...
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ì„ì‹œì €ì¥ ëª©ë¡ ëª¨ë‹¬ -->
<div class="modal fade" id="draftListModal" tabindex="-1">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-save me-2"></i>
                    ì„ì‹œì €ì¥ ëª©ë¡
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" style="max-height: 500px; overflow-y: auto;">
                <div id="draftListContainer">
                    <div class="text-center py-4">
                        <i class="fas fa-spinner fa-spin"></i>
                        ì„ì‹œì €ì¥ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ë‹«ê¸°</button>
            </div>
        </div>
    </div>
</div>

<!-- ë¯¸ë¦¬ë³´ê¸° ëª¨ë‹¬ -->
<div class="modal fade" id="previewModal" tabindex="-1">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-eye me-2"></i>
                    ë¯¸ë¦¬ë³´ê¸°
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div id="previewContent">
                    <!-- ë¯¸ë¦¬ë³´ê¸° ë‚´ìš©ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ë‹«ê¸°</button>
            </div>
        </div>
    </div>
</div>

<script th:inline="javascript">
    // ìë™ì €ì¥ ê´€ë ¨ ë³€ìˆ˜
    let autoSaveInterval;
    let autoSaveTimeout;
    let lastSavedContent = '';
    let hasUnsavedChanges = false;

    // beforeunload í•¸ë“¤ëŸ¬ë¥¼ ë³„ë„ í•¨ìˆ˜ë¡œ ë¶„ë¦¬
    function beforeUnloadHandler(e) {
        if (hasUnsavedChanges) {
            e.preventDefault();
            e.returnValue = '';
        }
    }

    $(document).ready(function() {
        // ğŸ”¥ ë“œë¡­ë‹¤ìš´ ë¬¸ì œ í•´ê²°ëœ Summernote ì„¤ì •
        $('#summernote').summernote({
            height: 400,
            minHeight: null,
            maxHeight: null,
            focus: true,
            lang: 'ko-KR',
            placeholder: 'ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”',

            // Bootstrap 5 í˜¸í™˜ toolbar ì„¤ì •
            toolbar: [
                ['style', ['style']],
                ['font', ['bold', 'italic', 'underline', 'strikethrough', 'clear']],
                ['fontname', ['fontname']],
                ['fontsize', ['fontsize']],
                ['color', ['forecolor', 'backcolor']],
                ['para', ['ul', 'ol', 'paragraph']],
                ['table', ['table']],
                ['insert', ['link', 'picture', 'video']],
                ['view', ['fullscreen', 'codeview', 'help']]
            ],

            // í°íŠ¸ ì„¤ì •
            fontNames: [
                'Arial', 'Arial Black', 'Comic Sans MS', 'Courier New',
                'Helvetica Neue', 'Helvetica', 'Impact', 'Lucida Grande',
                'Tahoma', 'Times New Roman', 'Verdana',
                'ë‚˜ëˆ”ê³ ë”•', 'ë‚˜ëˆ”ëª…ì¡°', 'ë§‘ì€ ê³ ë”•', 'ë‹ì›€', 'êµ´ë¦¼', 'ë°”íƒ•', 'ê¶ì„œ'
            ],

            // í°íŠ¸ í¬ê¸° ì„¤ì •
            fontSizes: ['8', '9', '10', '11', '12', '14', '16', '18', '20', '22', '24', '28', '30', '36', '48', '64', '72'],

            // ìƒ‰ìƒ íŒ”ë ˆíŠ¸ ì„¤ì •
            colors: [
                ['#000000', '#424242', '#636363', '#9C9C94', '#CEC6CE', '#EFEFEF', '#F7F3F7', '#FFFFFF'],
                ['#FF0000', '#FF9C00', '#FFFF00', '#00FF00', '#00FFFF', '#0000FF', '#9C00FF', '#FF00FF'],
                ['#F7C6CE', '#FFE7CE', '#FFEFC6', '#D6EFD6', '#CEDEE7', '#CEE7F7', '#D6D6E7', '#E7D6DE'],
                ['#E79C9C', '#FFC69C', '#FFE79C', '#B5D6A5', '#A5C6CE', '#9CC6EF', '#B5A5D6', '#D6A5BD'],
                ['#E76363', '#F7AD6B', '#FFD663', '#94BD7B', '#73A5AD', '#6BADDE', '#8C7BC6', '#C67BA5'],
                ['#CE0000', '#E79439', '#EFC631', '#6BA54A', '#4A7B8C', '#3984C6', '#634AA5', '#A54A7B'],
                ['#9C0000', '#B56308', '#BD9400', '#397B21', '#104A5A', '#085294', '#311873', '#731842'],
                ['#630000', '#7B3900', '#846300', '#295218', '#083139', '#003163', '#21104A', '#4A1031']
            ],

            // ìŠ¤íƒ€ì¼ íƒœê·¸ ì„¤ì •
            styleTags: [
                'p',
                { title: 'ì œëª© 1', tag: 'h1', className: '', value: 'h1' },
                { title: 'ì œëª© 2', tag: 'h2', className: '', value: 'h2' },
                { title: 'ì œëª© 3', tag: 'h3', className: '', value: 'h3' },
                { title: 'ì œëª© 4', tag: 'h4', className: '', value: 'h4' },
                { title: 'ì œëª© 5', tag: 'h5', className: '', value: 'h5' },
                { title: 'ì œëª© 6', tag: 'h6', className: '', value: 'h6' },
                { title: 'ì¸ìš©ë¬¸', tag: 'blockquote', className: 'blockquote', value: 'blockquote' },
                { title: 'ì½”ë“œ', tag: 'pre', className: '', value: 'pre' }
            ],

            // ì½œë°± í•¨ìˆ˜ë“¤
            callbacks: {
                onImageUpload: function(files) {
                    uploadSummernoteImage(files[0], this);
                },
                onChange: function(contents) {
                    // ìë™ì €ì¥ íƒ€ì´ë¨¸ ì¬ì„¤ì •
                    if (typeof resetAutoSaveTimer === 'function') {
                        resetAutoSaveTimer();
                    }
                },
                onInit: function() {
                    console.log('Summernote ì´ˆê¸°í™” ì™„ë£Œ');

                    // ğŸ”¥ ë“œë¡­ë‹¤ìš´ ì´ˆê¸° ìƒíƒœ ì„¤ì • + ëª¨ë‹¬ ë‹¤ì´ì–¼ë¡œê·¸ ë‹«ê¸° ê¸°ëŠ¥ ì¶”ê°€
                    setTimeout(function() {
                        setupDropdownBehavior();
                        setupModalDialogs(); // ğŸ”¥ ì´ í•œ ì¤„ë§Œ ì¶”ê°€!
                    }, 300);
                }
            },

            // í…Œì´ë¸” ì„¤ì •
            table: {
                className: 'table table-bordered'
            },

            // ë§í¬ ì„¤ì •
            link: {
                rel: 'nofollow',
                target: '_blank'
            },

            // ì´ë¯¸ì§€ ì„¤ì •
            image: {
                resizeEnabled: true,
                disableResizeEditor: false
            },

            // ì¶”ê°€ ì„¤ì •ë“¤
            disableDragAndDrop: false,
            shortcuts: true,
            tabsize: 2,
            lineHeights: ['0.2', '0.3', '0.4', '0.5', '0.6', '0.8', '1.0', '1.2', '1.4', '1.5', '2.0', '3.0']
        });

        // ğŸ”¥ ê°œì„ ëœ ë“œë¡­ë‹¤ìš´ ë™ì‘ ì„¤ì •
        function setupDropdownBehavior() {
            console.log('ë“œë¡­ë‹¤ìš´ ë™ì‘ ì„¤ì • ì‹œì‘');

            // ê¸°ë³¸ì ìœ¼ë¡œ ëª¨ë“  ë“œë¡­ë‹¤ìš´ ìˆ¨ê¸°ê¸°
            $('.note-dropdown-menu').each(function() {
                $(this).removeClass('show').hide();
            });

            // ë“œë¡­ë‹¤ìš´ì´ ìˆëŠ” ë²„íŠ¼ë“¤ë§Œ ì²˜ë¦¬ (ê¸°ë³¸ ê¸°ëŠ¥ ë²„íŠ¼ì€ ê±´ë“œë¦¬ì§€ ì•ŠìŒ)
            $('.note-fontname .note-btn, .note-fontsize .note-btn, .note-color .note-btn, .note-para .note-btn, .note-table .note-btn, .note-style .note-btn').off('click.custom').on('click.custom', function(e) {
                const $this = $(this);
                const $dropdown = $this.siblings('.note-dropdown-menu').first();

                if ($dropdown.length > 0) {
                    e.preventDefault();
                    e.stopPropagation();

                    console.log('ë“œë¡­ë‹¤ìš´ ë²„íŠ¼ í´ë¦­:', $this.attr('class'));

                    // ë‹¤ë¥¸ ëª¨ë“  ë“œë¡­ë‹¤ìš´ ìˆ¨ê¸°ê¸°
                    $('.note-dropdown-menu').not($dropdown).removeClass('show').hide();

                    // í˜„ì¬ ë“œë¡­ë‹¤ìš´ í† ê¸€
                    if ($dropdown.is(':visible')) {
                        $dropdown.removeClass('show').hide();
                    } else {
                        $dropdown.addClass('show').show();
                    }
                }
            });

            // ë“œë¡­ë‹¤ìš´ ë©”ë‰´ ì•„ì´í…œ í´ë¦­ ì‹œ ì²˜ë¦¬
            $('.note-dropdown-menu').off('click.custom').on('click.custom', function(e) {
                const $target = $(e.target);

                // ì‹¤ì œ ë“œë¡­ë‹¤ìš´ ì•„ì´í…œì„ í´ë¦­í•œ ê²½ìš°
                if ($target.hasClass('note-dropdown-item') || $target.closest('.note-dropdown-item').length > 0) {
                    console.log('ë“œë¡­ë‹¤ìš´ ì•„ì´í…œ ì„ íƒë¨');

                    // ì„ íƒ í›„ ë“œë¡­ë‹¤ìš´ ë‹«ê¸°
                    setTimeout(() => {
                        $(this).removeClass('show').hide();
                    }, 100);
                }
            });

            // ë¬¸ì„œ í´ë¦­ ì‹œ ë“œë¡­ë‹¤ìš´ ë‹«ê¸° (ì—ë””í„° ì˜ì—­ ì œì™¸)
            $(document).off('click.summernote').on('click.summernote', function(e) {
                if (!$(e.target).closest('.note-editor').length) {
                    $('.note-dropdown-menu').removeClass('show').hide();
                }
            });

            // ìƒ‰ìƒ ì„ íƒ ì‹œ íŠ¹ë³„ ì²˜ë¦¬
            $('.note-color-palette').off('click.custom').on('click.custom', '.note-color-btn', function(e) {
                console.log('ìƒ‰ìƒ ì„ íƒë¨');
                setTimeout(() => {
                    $('.note-dropdown-menu').removeClass('show').hide();
                }, 150);
            });
        }

// ğŸ”¥ ìˆ˜ì •ëœ ëª¨ë‹¬ ë‹¤ì´ì–¼ë¡œê·¸ ì„¤ì • í•¨ìˆ˜ (ìë™ìœ¼ë¡œ ì—´ë¦¬ì§€ ì•Šê²Œ)
        function setupModalDialogs() {
            console.log('ëª¨ë‹¬ ë‹¤ì´ì–¼ë¡œê·¸ ì„¤ì • ì‹œì‘');

            // ê¸°ì¡´ì— ì—´ë ¤ìˆëŠ” ëª¨ë“  ëª¨ë‹¬ ê°•ì œë¡œ ìˆ¨ê¸°ê¸°
            $('.note-modal, [class*="note-"][class*="-dialog"]').each(function() {
                $(this).hide().remove();
            });
            $('.modal-backdrop, .note-modal-backdrop').remove();

            // ëª¨ë‹¬ì´ ì‹¤ì œë¡œ ìƒì„±ë  ë•Œë§Œ ì²˜ë¦¬í•˜ë„ë¡ ì´ë²¤íŠ¸ ìœ„ì„ ì‚¬ìš©
            $(document).off('click.summernote-modal').on('click.summernote-modal', '.note-btn', function(e) {
                const $btn = $(this);

                // ë§í¬, ì´ë¯¸ì§€, ë™ì˜ìƒ ë²„íŠ¼ì¸ì§€ í™•ì¸
                if ($btn.hasClass('note-btn-link') ||
                    $btn.hasClass('note-btn-picture') ||
                    $btn.hasClass('note-btn-video') ||
                    $btn.closest('.note-insert').length > 0) {

                    console.log('ëª¨ë‹¬ ë²„íŠ¼ í´ë¦­ë¨:', $btn.attr('class'));

                    // ì ì‹œ í›„ ìƒì„±ë  ëª¨ë‹¬ì— ëŒ€í•´ ë‹«ê¸° ê¸°ëŠ¥ ì„¤ì •
                    setTimeout(function() {
                        setupModalCloseHandlers();
                    }, 100);
                }
            });

            // MutationObserverë¥¼ ì‚¬ìš©í•´ì„œ ìƒˆë¡œ ìƒì„±ë˜ëŠ” ëª¨ë‹¬ë§Œ ê°ì§€
            if (window.MutationObserver) {
                const observer = new MutationObserver(function(mutations) {
                    mutations.forEach(function(mutation) {
                        mutation.addedNodes.forEach(function(node) {
                            if (node.nodeType === 1) { // Element ë…¸ë“œë§Œ
                                const $node = $(node);

                                // ìƒˆë¡œ ì¶”ê°€ëœ ë…¸ë“œê°€ ëª¨ë‹¬ì´ê±°ë‚˜ ëª¨ë‹¬ì„ í¬í•¨í•˜ëŠ” ê²½ìš°
                                if ($node.hasClass('note-modal') ||
                                    $node.find('.note-modal').length > 0 ||
                                    $node.attr('class') && $node.attr('class').includes('note-') &&
                                    $node.attr('class').includes('-dialog')) {

                                    console.log('ìƒˆë¡œìš´ ëª¨ë‹¬ì´ ìƒì„±ë¨');
                                    setTimeout(function() {
                                        setupModalCloseHandlers();
                                    }, 50);
                                }
                            }
                        });
                    });
                });

                // bodyì˜ ë³€í™”ë¥¼ ê´€ì°°
                observer.observe(document.body, {
                    childList: true,
                    subtree: true
                });
            }
        }

// ëª¨ë‹¬ ë‹«ê¸° í•¸ë“¤ëŸ¬ ì„¤ì • (ì‹¤ì œë¡œ ì—´ë¦° ëª¨ë‹¬ì—ë§Œ ì ìš©)
        function setupModalCloseHandlers() {
            $('.note-modal:visible, [class*="note-"][class*="-dialog"]:visible').each(function() {
                const $modal = $(this);

                // ì´ë¯¸ ì²˜ë¦¬ëœ ëª¨ë‹¬ì€ ê±´ë„ˆë›°ê¸°
                if ($modal.data('close-handler-set')) return;
                $modal.data('close-handler-set', true);

                console.log('ë³´ì´ëŠ” ëª¨ë‹¬ì— ë‹«ê¸° í•¸ë“¤ëŸ¬ ì„¤ì •:', $modal.attr('class'));

                // ë‹«ê¸° ë²„íŠ¼ë“¤ ì°¾ê¸° ë° ì´ë²¤íŠ¸ ì„¤ì •
                const closeSelectors = [
                    '.close',
                    '.btn-close',
                    'button[data-dismiss="modal"]',
                    'button[aria-label="Close"]',
                    '.note-modal-header button:last-child',  // í—¤ë”ì˜ ë§ˆì§€ë§‰ ë²„íŠ¼ (ë³´í†µ ë‹«ê¸° ë²„íŠ¼)
                    'button[title="Close"]'
                ];

                closeSelectors.forEach(function(selector) {
                    $modal.find(selector).off('click.modal-close').on('click.modal-close', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        console.log('ë‹«ê¸° ë²„íŠ¼ í´ë¦­ë¨:', selector);
                        closeModal($modal);
                    });
                });

                // ESC í‚¤ë¡œ ë‹«ê¸°
                $modal.off('keydown.modal-close').on('keydown.modal-close', function(e) {
                    if (e.key === 'Escape' || e.keyCode === 27) {
                        e.preventDefault();
                        console.log('ESC í‚¤ë¡œ ëª¨ë‹¬ ë‹«ê¸°');
                        closeModal($modal);
                    }
                });

                // ëª¨ë‹¬ ë°°ê²½ í´ë¦­ìœ¼ë¡œ ë‹«ê¸°
                $modal.off('click.modal-close').on('click.modal-close', function(e) {
                    if (e.target === this || $(e.target).hasClass('note-modal')) {
                        console.log('ë°°ê²½ í´ë¦­ìœ¼ë¡œ ëª¨ë‹¬ ë‹«ê¸°');
                        closeModal($modal);
                    }
                });

                // ëª¨ë‹¬ì— í¬ì»¤ìŠ¤ ì„¤ì • (ESC í‚¤ ë™ì‘ì„ ìœ„í•´)
                $modal.attr('tabindex', '-1').focus();
            });
        }

// ğŸ”¥ ê°œì„ ëœ ëª¨ë‹¬ ë‹«ê¸° í•¨ìˆ˜
        function closeModal($modal) {
            console.log('ëª¨ë‹¬ ë‹«ê¸° ì‹¤í–‰');

            try {
                // Summernote ëª¨ë‹¬ ë‹«ê¸°
                if ($modal.hasClass('note-modal') || $modal.attr('class').includes('note-')) {
                    $modal.fadeOut(150, function() {
                        $modal.remove();
                    });
                } else {
                    // ì¼ë°˜ ëª¨ë‹¬ ë‹«ê¸°
                    $modal.hide();
                }

                // ëª¨ë‹¬ ë°°ê²½ ì œê±°
                $('.modal-backdrop, .note-modal-backdrop').remove();

                // body ìŠ¤í¬ë¡¤ ë³µì›
                $('body').removeClass('modal-open').css('overflow', '');

                console.log('ëª¨ë‹¬ ë‹«ê¸° ì™„ë£Œ');

            } catch (error) {
                console.log('ëª¨ë‹¬ ë‹«ê¸° ì˜¤ë¥˜:', error);
                // ì˜¤ë¥˜ ë°œìƒ ì‹œ ê°•ì œ ì œê±°
                $modal.remove();
                $('.modal-backdrop, .note-modal-backdrop').remove();
                $('body').removeClass('modal-open').css('overflow', '');
            }
        }


        // íŒŒì¼ ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì„¤ì •
        setupFileDragDrop();

        // ìë™ì €ì¥ ì‹œì‘
        startAutoSave();

        // ìµœê·¼ ì‘ì„±ê¸€ ë¡œë“œ
        loadRecentPosts();

        // URL íŒŒë¼ë¯¸í„°ì—ì„œ draftId í™•ì¸í•˜ì—¬ ë¶ˆëŸ¬ì˜¤ê¸°
        const urlParams = new URLSearchParams(window.location.search);
        const draftId = urlParams.get('draftId');
        if (draftId) {
            loadDraft(draftId);
        }

        // í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤ ì„¤ì •
        setupKeyboardShortcuts();

        // ì œëª©ì´ë‚˜ ë‚´ìš© ë³€ê²½ ì‹œ hasUnsavedChanges ì„¤ì •
        $('#title').on('input', function() {
            hasUnsavedChanges = true;
        });

        $('#categoryId').on('change', function() {
            hasUnsavedChanges = true;
        });
    });

    // ìë™ì €ì¥ ì‹œì‘
    function startAutoSave() {
        autoSaveInterval = setInterval(function() {
            autoSaveDraft();
        }, 30000); // 30ì´ˆë§ˆë‹¤ ìë™ì €ì¥
    }

    // ìë™ì €ì¥ íƒ€ì´ë¨¸ ì¬ì„¤ì •
    function resetAutoSaveTimer() {
        hasUnsavedChanges = true;
        clearTimeout(autoSaveTimeout);
        autoSaveTimeout = setTimeout(function() {
            autoSaveDraft();
        }, 5000); // 5ì´ˆ í›„ ìë™ì €ì¥
    }

    // ìë™ì €ì¥ ì‹¤í–‰
    function autoSaveDraft() {
        const content = $('#summernote').summernote('code');
        const title = $('#title').val().trim();
        const categoryId = $('#categoryId').val();

        // ë‚´ìš©ì´ ë°”ë€Œì—ˆê³  ì œëª©ì´ë‚˜ ë‚´ìš©ì´ ìˆì„ ë•Œë§Œ ì €ì¥
        if (hasUnsavedChanges && (title || content.trim() !== '<p><br></p>')) {
            showAutoSaveStatus('saving');

            $.ajax({
                url: '/api/community/draft/auto-save',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({
                    draftId: $('#draftId').val() || null,
                    title: title,
                    content: content,
                    categoryId: categoryId || null
                }),
                success: function(response) {
                    if (response.success) {
                        $('#draftId').val(response.draftId);
                        lastSavedContent = content;
                        hasUnsavedChanges = false;
                        showAutoSaveStatus('saved');
                    } else {
                        showAutoSaveStatus('error');
                    }
                },
                error: function() {
                    showAutoSaveStatus('error');
                }
            });
        }
    }

    // ìë™ì €ì¥ ìƒíƒœ í‘œì‹œ
    function showAutoSaveStatus(status) {
        const statusDiv = $('#autoSaveStatus');
        const textSpan = $('#autoSaveText');

        statusDiv.removeClass('saving error').show();

        switch(status) {
            case 'saving':
                statusDiv.addClass('saving');
                textSpan.html('<i class="fas fa-spinner fa-spin me-2"></i>ì €ì¥ ì¤‘...');
                break;
            case 'saved':
                textSpan.html('<i class="fas fa-check me-2"></i>ìë™ì €ì¥ë¨ ' + new Date().toLocaleTimeString());
                setTimeout(() => statusDiv.fadeOut(), 3000);
                break;
            case 'error':
                statusDiv.addClass('error');
                textSpan.html('<i class="fas fa-exclamation-triangle me-2"></i>ì €ì¥ ì‹¤íŒ¨');
                setTimeout(() => statusDiv.fadeOut(), 5000);
                break;
        }
    }

    // ìˆ˜ë™ ì„ì‹œì €ì¥
    $('#saveAsDraft').click(function() {
        const content = $('#summernote').summernote('code');
        const title = $('#title').val().trim();
        const categoryId = $('#categoryId').val();

        if (!title && content.trim() === '<p><br></p>') {
            alert('ì œëª©ì´ë‚˜ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            return;
        }

        $.ajax({
            url: '/api/community/draft/save',
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify({
                draftId: $('#draftId').val() || null,
                title: title,
                content: content,
                categoryId: categoryId || null
            }),
            success: function(response) {
                if (response.success) {
                    $('#draftId').val(response.draftId);
                    hasUnsavedChanges = false;
                    showSuccessMessage('ì„ì‹œì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
                }
            }
        });
    });

    // ì„ì‹œì €ì¥ ëª©ë¡ ë²„íŠ¼
    $('#draftListBtn').click(function() {
        loadDraftList();
        $('#draftListModal').modal('show');
    });

    // ë¯¸ë¦¬ë³´ê¸° ë²„íŠ¼
    $('#previewBtn').click(function() {
        showPreview();
    });

    // ë‚˜ë¨¸ì§€ í•¨ìˆ˜ë“¤ (ê¸°ì¡´ê³¼ ë™ì¼)
    function loadDraftList() {
        $.ajax({
            url: '/api/community/draft/list',
            type: 'GET',
            success: function(response) {
                renderDraftList(response.drafts);
            },
            error: function() {
                $('#draftListContainer').html('<div class="text-center text-danger">ì„ì‹œì €ì¥ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>');
            }
        });
    }

    function renderDraftList(drafts) {
        let html = '';
        if (drafts.length === 0) {
            html = '<div class="text-center py-4 text-muted">ì„ì‹œì €ì¥ëœ ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
        } else {
            drafts.forEach(function(draft) {
                html += `
                    <div class="draft-item">
                        <div class="d-flex justify-content-between align-items-start">
                            <div class="flex-grow-1">
                                <h6 class="mb-2">${draft.title || '(ì œëª© ì—†ìŒ)'}</h6>
                                <p class="text-muted mb-2">${truncateHtml(draft.content, 150)}</p>
                                <div class="draft-meta">
                                    <i class="fas fa-clock me-1"></i>
                                    ìµœì¢… ìˆ˜ì •: ${formatDate(draft.updatedAt)}
                                </div>
                            </div>
                            <div class="ms-3">
                                <button class="btn btn-sm btn-primary me-2" onclick="loadDraft(${draft.draftId})">
                                    <i class="fas fa-edit me-1"></i>ë¶ˆëŸ¬ì˜¤ê¸°
                                </button>
                                <button class="btn btn-sm btn-danger" onclick="deleteDraft(${draft.draftId})">
                                    <i class="fas fa-trash me-1"></i>ì‚­ì œ
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            });
        }
        $('#draftListContainer').html(html);
    }

    function loadDraft(draftId) {
        $.ajax({
            url: `/api/community/draft/${draftId}`,
            type: 'GET',
            success: function(response) {
                if (response.success) {
                    const draft = response.draft;
                    $('#draftId').val(draft.draftId);
                    $('#title').val(draft.title);
                    $('#categoryId').val(draft.categoryId);
                    $('#summernote').summernote('code', draft.content);
                    lastSavedContent = draft.content;
                    hasUnsavedChanges = false;
                    $('#draftListModal').modal('hide');
                    showSuccessMessage('ì„ì‹œì €ì¥ëœ ê¸€ì„ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.');
                }
            }
        });
    }

    function deleteDraft(draftId) {
        if (confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
            $.ajax({
                url: `/api/community/draft/${draftId}`,
                type: 'DELETE',
                success: function(response) {
                    if (response.success) {
                        loadDraftList();
                        showSuccessMessage('ì„ì‹œì €ì¥ëœ ê¸€ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                    }
                }
            });
        }
    }

    function showPreview() {
        const title = $('#title').val().trim();
        const content = $('#summernote').summernote('code');
        const categoryName = $('#categoryId option:selected').text();

        if (!title && content.trim() === '<p><br></p>') {
            alert('ì œëª©ì´ë‚˜ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            return;
        }

        const previewHtml = `
            <div class="card">
                <div class="card-header bg-light">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <span class="badge bg-secondary me-2">${categoryName}</span>
                            <h2 class="d-inline">${title || '(ì œëª© ì—†ìŒ)'}</h2>
                        </div>
                    </div>
                    <div class="text-muted small mt-2">
                        <i class="fas fa-user me-1"></i>
                        ì‘ì„±ì |
                        <i class="fas fa-calendar me-1"></i>
                        ${new Date().toLocaleString()}
                    </div>
                </div>
                <div class="card-body">
                    <div class="post-content" style="min-height: 300px; line-height: 1.7;">
                        ${content}
                    </div>
                </div>
            </div>
        `;
        $('#previewContent').html(previewHtml);
        $('#previewModal').modal('show');
    }

    function setupFileDragDrop() {
        const uploadArea = $('#fileUploadArea');
        uploadArea.on('dragover', function(e) {
            e.preventDefault();
            $(this).addClass('dragover');
        });
        uploadArea.on('dragleave', function(e) {
            e.preventDefault();
            $(this).removeClass('dragover');
        });
        uploadArea.on('drop', function(e) {
            e.preventDefault();
            $(this).removeClass('dragover');
            const files = e.originalEvent.dataTransfer.files;
            $('#files')[0].files = files;
            updateFileList();
        });
        $('#files').change(function() {
            updateFileList();
        });
    }

    function updateFileList() {
        const files = $('#files')[0].files;
        let html = '';
        if (files.length > 0) {
            html += '<div class="mt-2"><strong>ì„ íƒëœ íŒŒì¼:</strong></div>';
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                const size = (file.size / 1024).toFixed(1);
                html += `
                    <div class="d-flex justify-content-between align-items-center py-1">
                        <span><i class="fas fa-file me-1"></i>${file.name}</span>
                        <small class="text-muted">${size} KB</small>
                    </div>
                `;
            }
        }
        $('#fileList').html(html);
    }

    // ğŸ”¥ ìˆ˜ì •ëœ ì´ë¯¸ì§€ ì—…ë¡œë“œ í•¨ìˆ˜
    function uploadSummernoteImage(file, editor) {
        const formData = new FormData();
        formData.append('file', file);

        $.ajax({
            url: '/community/upload-image',
            type: 'POST',
            data: formData,
            contentType: false,
            processData: false,
            success: function(data) {
                if (data.imageUrl) {
                    $(editor).summernote('insertImage', data.imageUrl);
                } else {
                    alert('ì´ë¯¸ì§€ ì—…ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            },
            error: function() {
                alert('ì´ë¯¸ì§€ ì—…ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        });
    }

    function loadRecentPosts() {
        const mockPosts = [
            { title: "ì´ì „ ì‘ì„±ê¸€ 1", date: "2024-01-15" },
            { title: "ì´ì „ ì‘ì„±ê¸€ 2", date: "2024-01-14" },
            { title: "ì´ì „ ì‘ì„±ê¸€ 3", date: "2024-01-13" }
        ];
        let html = '';
        mockPosts.forEach(post => {
            html += `
                <div class="mb-2 pb-2 border-bottom">
                    <div class="fw-bold">${post.title}</div>
                    <small class="text-muted">${post.date}</small>
                </div>
            `;
        });
        $('#recentPosts').html(html);
    }

    function setupKeyboardShortcuts() {
        $(document).keydown(function(e) {
            if (e.ctrlKey && e.which === 13) {
                e.preventDefault();
                $('#postForm').submit();
            }
            if (e.ctrlKey && e.which === 83) {
                e.preventDefault();
                $('#saveAsDraft').click();
            }
        });
    }

    // í¼ ì œì¶œ ì‹œ ì²˜ë¦¬
    $('#postForm').on('submit', function(e) {
        const title = $('#title').val().trim();
        const content = $('#summernote').summernote('code');

        if (!title) {
            alert('ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            e.preventDefault();
            return;
        }

        if (content.trim() === '<p><br></p>' || !content.trim()) {
            alert('ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            e.preventDefault();
            return;
        }

        if (!confirm('ê²Œì‹œê¸€ì„ ë“±ë¡í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
            e.preventDefault();
            return;
        }

        hasUnsavedChanges = false;
        window.removeEventListener('beforeunload', beforeUnloadHandler);
        clearInterval(autoSaveInterval);
        clearTimeout(autoSaveTimeout);

        const draftId = $('#draftId').val();
        if (draftId) {
            $.ajax({
                url: `/api/community/draft/${draftId}`,
                type: 'DELETE',
                async: false
            });
        }
    });

    function confirmCancel() {
        if (hasUnsavedChanges) {
            if (confirm('ì‘ì„± ì¤‘ì¸ ë‚´ìš©ì´ ìˆìŠµë‹ˆë‹¤. ì •ë§ ë‚˜ê°€ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                hasUnsavedChanges = false;
                window.removeEventListener('beforeunload', beforeUnloadHandler);
                window.location.href = '/community';
            }
        } else {
            window.location.href = '/community';
        }
    }

    window.addEventListener('beforeunload', beforeUnloadHandler);

    function formatDate(dateString) {
        return new Date(dateString).toLocaleString();
    }

    function truncateHtml(html, length) {
        const div = document.createElement('div');
        div.innerHTML = html;
        const text = div.textContent || div.innerText || '';
        return text.length > length ? text.substring(0, length) + '...' : text;
    }

    function showSuccessMessage(message) {
        const alertDiv = $(`
            <div class="alert alert-success alert-dismissible fade show position-fixed"
                 style="top: 20px; right: 20px; z-index: 9999; min-width: 300px;">
                <i class="fas fa-check-circle me-2"></i>
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
        `);
        $('body').append(alertDiv);
        setTimeout(() => alertDiv.alert('close'), 3000);
    }
</script>
</body>
</html>