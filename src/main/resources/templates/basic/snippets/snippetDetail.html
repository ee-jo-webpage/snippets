async function toggleBookmark() {
		      try {
		        console.log('ë¶ë§ˆí¬ í† ê¸€ ì‹œë„ - ìŠ¤ë‹ˆí« ID:', snippetId);
		        
		        // 1ì°¨ ì‹œë„: BookmarkRestController ì—”ë“œí¬ì¸íŠ¸
		        await toggleBookmarkViaAPI();
		        
		      } catch (error) {
		        console.error('API ë°©ì‹ ë¶ë§ˆí¬ í† ê¸€ ì‹¤íŒ¨:', error);
		        
		        try {
		          // 2ì°¨ ì‹œë„: í¼ ë°©ì‹
		          await toggleBookmarkViaForm();
		          
		        } catch (error2) {
		          console.error('í¼ ë°©ì‹ ë¶ë§ˆí¬ í† ê¸€ë„ ì‹¤íŒ¨:', error2);
		          showToast('ë¶ë§ˆí¬ ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
		        }
		      }
		    }

		    async function toggleBookmarkViaAPI() {
		      const response = await fetch('/api/bookmarks/toggle', {
		        method: 'POST',
		        credentials: 'same-origin',
		        headers: {
		          'Content-Type': 'application/x-www-form-urlencoded',
		          [csrfHeader]: csrfToken
		        },
		        body: new URLSearchParams({ snippetId: snippetId.toString() })
		      });

		      console.log('ë¶ë§ˆí¬ í† ê¸€ ì‘ë‹µ ìƒíƒœ (API):', response.status);

		      if (!response.ok) {
		        if (response.status === 401) {
		          showToast('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
		          return;
		        }
		        const errorText = await response.text();
		        console.error('ë¶ë§ˆí¬ í† ê¸€ ì‘ë‹µ ì˜¤ë¥˜:', response.status, errorText);
		        throw new Error(`ë¶ë§ˆí¬ ì²˜ë¦¬ ì‹¤íŒ¨ (${response.status})`);
		      }

		      const result = await response.json();
		      console.log('ë¶ë§ˆí¬ í† ê¸€ ê²°ê³¼ (API):', result);
		      
		      // BookmarkRestControllerì˜ ì‘ë‹µ í˜•íƒœ: { "success": true, "bookmarked": boolean, "message": string }
		      if (result.success) {
		        isBookmarked = result.bookmarked;
		        updateBookmarkButton();
		        showToast(result.message || (isBookmarked ? 'ë¶ë§ˆí¬ì— ì¶”ê°€í–ˆìŠµë‹ˆë‹¤.' : 'ë¶ë§ˆí¬ì—ì„œ ì œê±°í–ˆìŠµë‹ˆë‹¤.'));
		      } else {
		        throw new Error(result.message || 'ë¶ë§ˆí¬ ì²˜ë¦¬ ì‹¤íŒ¨');
		      }
		    }

		    async function toggleBookmarkViaForm() {
		      const formData = new FormData();
		      formData.append('snippetId', snippetId);
		      formData.append('_csrf', csrfToken);

		      const response = await fetch('/bookmarks/toggle', {<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="_csrf"       th:content="${_csrf.token}"/>
	<meta name="_csrf_header" th:content="${_csrf.headerName}"/>
	<link th:href="@{/my-snippet-page/css/my-snippet-page.css}" rel="stylesheet">
	<title th:text="'ìŠ¤ë‹ˆí« #' + ${snippet.snippetId}">Snippet ìƒì„¸ ì •ë³´</title>
	<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
	<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet">
	<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
	<script
		src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
	<style>
		/* ë©”ì¸ ì»¨í…Œì´ë„ˆ */
		.main-content {
			padding: 0;
			background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
			min-height: 100vh;
		}

		.detail-container {
			max-width: 1000px;
			margin: 0 auto;
			padding: 40px 20px;
		}

		/* í—¤ë” ì˜ì—­ */
		.snippet-header {
			background: rgba(255, 255, 255, 0.95);
			backdrop-filter: blur(20px);
			border-radius: 20px;
			padding: 30px;
			margin-bottom: 30px;
			box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
			border: 1px solid rgba(255, 255, 255, 0.2);
		}

		.header-top {
			display: flex;
			justify-content: space-between;
			align-items: flex-start;
			margin-bottom: 20px;
		}

		.snippet-id-badge {
			background: linear-gradient(135deg, #667eea, #764ba2);
			color: white;
			padding: 8px 16px;
			border-radius: 25px;
			font-size: 0.9rem;
			font-weight: 600;
			box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
		}

		.snippet-title {
			font-size: 2.2rem;
			color: #2d3748;
			margin: 0 0 15px 0;
			font-weight: 700;
			line-height: 1.2;
		}

		.snippet-meta {
			display: flex;
			gap: 20px;
			align-items: center;
			flex-wrap: wrap;
			margin-bottom: 20px;
		}

		.meta-item {
			display: flex;
			align-items: center;
			gap: 8px;
			padding: 8px 16px;
			background: rgba(247, 250, 252, 0.8);
			border-radius: 20px;
			font-size: 0.9rem;
			color: #4a5568;
			border: 1px solid rgba(226, 232, 240, 0.5);
		}

		.type-badge {
			padding: 8px 16px;
			border-radius: 20px;
			font-size: 0.9rem;
			font-weight: 600;
			text-transform: uppercase;
		}

		.type-code {
			background: linear-gradient(135deg, #667eea, #5a67d8);
			color: white;
			box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
		}

		.type-text {
			background: linear-gradient(135deg, #48bb78, #38a169);
			color: white;
			box-shadow: 0 2px 8px rgba(72, 187, 120, 0.3);
		}

		.type-img {
			background: linear-gradient(135deg, #ed8936, #dd6b20);
			color: white;
			box-shadow: 0 2px 8px rgba(237, 137, 54, 0.3);
		}

		/* ë©”ì¸ ì½˜í…ì¸  ì˜ì—­ */
		.snippet-content {
			background: rgba(255, 255, 255, 0.95);
			backdrop-filter: blur(20px);
			border-radius: 20px;
			padding: 40px;
			margin-bottom: 30px;
			box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
			border: 1px solid rgba(255, 255, 255, 0.2);
		}

		.content-header {
			display: flex;
			justify-content: space-between;
			align-items: center;
			margin-bottom: 25px;
			padding-bottom: 15px;
			border-bottom: 2px solid rgba(226, 232, 240, 0.3);
		}

		.content-title {
			font-size: 1.4rem;
			color: #2d3748;
			font-weight: 600;
			display: flex;
			align-items: center;
			gap: 10px;
		}

		.copy-btn {
			padding: 8px 16px;
			background: linear-gradient(135deg, #48bb78, #38a169);
			color: white;
			border: none;
			border-radius: 25px;
			cursor: pointer;
			font-size: 0.9rem;
			font-weight: 600;
			transition: all 0.3s ease;
			display: flex;
			align-items: center;
			gap: 8px;
		}

		.copy-btn:hover {
			transform: translateY(-2px);
			box-shadow: 0 8px 25px rgba(72, 187, 120, 0.4);
		}

		/* ì½”ë“œ ìŠ¤íƒ€ì¼ */
		.code-container {
			position: relative;
			background: #1a202c;
			border-radius: 15px;
			overflow: hidden;
			box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
			border: 1px solid #2d3748;
		}

		.code-header {
			background: #2d3748;
			padding: 15px 20px;
			display: flex;
			justify-content: space-between;
			align-items: center;
			border-bottom: 1px solid #4a5568;
		}

		.language-badge {
			background: rgba(102, 126, 234, 0.3);
			color: #e2e8f0;
			padding: 6px 12px;
			border-radius: 12px;
			font-size: 0.85rem;
			font-weight: 600;
		}

		.code-content {
			max-height: 600px;
			overflow: auto;
			font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
			background: #1a202c;
		}

		.code-content pre {
			margin: 0;
			padding: 25px;
			background: transparent;
			color: #e2e8f0;
			font-size: 0.95rem;
			line-height: 1.6;
			white-space: pre-wrap;
			word-wrap: break-word;
		}

		.code-content code {
			background: transparent;
			color: inherit;
			font-family: inherit;
			font-size: inherit;
		}

		/* í…ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ */
		.text-content {
			background: rgba(247, 250, 252, 0.8);
			border: 2px solid rgba(72, 187, 120, 0.2);
			border-radius: 15px;
			padding: 30px;
			font-size: 1.1rem;
			line-height: 1.8;
			color: #2d3748;
			min-height: 200px;
			white-space: pre-wrap;
			word-wrap: break-word;
		}

		.text-content span {
			display: block;
			width: 100%;
		}

		/* ì´ë¯¸ì§€ ìŠ¤íƒ€ì¼ */
		.image-container {
			text-align: center;
			padding: 20px;
		}

		.snippet-image {
			max-width: 100%;
			max-height: 600px;
			width: auto;
			height: auto;
			border-radius: 15px;
			box-shadow: 0 15px 40px rgba(0, 0, 0, 0.1);
			transition: transform 0.3s ease;
		}

		.snippet-image:hover {
			transform: scale(1.02);
		}

		.image-alt-text {
			margin-top: 20px;
			padding: 15px 25px;
			background: rgba(237, 137, 54, 0.1);
			border-radius: 15px;
			color: #744210;
			font-style: italic;
			font-size: 1rem;
			max-width: 600px;
			margin-left: auto;
			margin-right: auto;
		}

		/* ì¶”ê°€ ì •ë³´ ì„¹ì…˜ */
		.snippet-info {
			background: rgba(255, 255, 255, 0.95);
			backdrop-filter: blur(20px);
			border-radius: 20px;
			padding: 30px;
			margin-bottom: 30px;
			box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
			border: 1px solid rgba(255, 255, 255, 0.2);
		}

		.info-grid {
			display: grid;
			grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
			gap: 20px;
		}

		.info-item {
			padding: 20px;
			background: rgba(247, 250, 252, 0.5);
			border-radius: 15px;
			border: 1px solid rgba(226, 232, 240, 0.3);
		}

		.info-label {
			font-size: 0.85rem;
			color: #718096;
			font-weight: 600;
			text-transform: uppercase;
			letter-spacing: 0.5px;
			margin-bottom: 8px;
		}

		.info-value {
			font-size: 1rem;
			color: #2d3748;
			font-weight: 500;
			word-break: break-all;
		}

		/* íƒœê·¸ ì„¹ì…˜ ìŠ¤íƒ€ì¼ */
		.snippet-tags-section {
			background: rgba(255, 255, 255, 0.95);
			backdrop-filter: blur(20px);
			border-radius: 20px;
			padding: 30px;
			margin-bottom: 30px;
			box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
			border: 1px solid rgba(255, 255, 255, 0.2);
		}

		.snippet-tags-section h4 {
			font-size: 1.2rem;
			color: #2d3748;
			margin-bottom: 20px;
			font-weight: 600;
		}

		.snippet-tags-display {
			display: flex;
			flex-wrap: wrap;
			gap: 10px;
			margin-bottom: 20px;
			min-height: 40px;
			align-items: flex-start;
		}

		.tag-badge {
			background: linear-gradient(135deg, #667eea, #764ba2);
			color: white;
			padding: 6px 12px;
			border-radius: 20px;
			font-size: 0.85rem;
			font-weight: 500;
			display: inline-flex;
			align-items: center;
			gap: 6px;
			box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
			transition: all 0.3s ease;
		}

		.tag-badge:hover {
			transform: translateY(-1px);
			box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
		}

		.tag-remove {
			background: rgba(255, 255, 255, 0.2);
			border: none;
			border-radius: 50%;
			width: 18px;
			height: 18px;
			display: flex;
			align-items: center;
			justify-content: center;
			cursor: pointer;
			font-size: 0.7rem;
			color: white;
			transition: background-color 0.2s ease;
		}

		.tag-remove:hover {
			background: rgba(255, 255, 255, 0.3);
		}

		.snippet-tags-input {
			display: flex;
			gap: 10px;
			align-items: center;
			flex-wrap: wrap;
		}

		.tag-input {
			flex: 1;
			min-width: 200px;
			padding: 12px 16px;
			border: 2px solid rgba(102, 126, 234, 0.2);
			border-radius: 25px;
			font-size: 0.9rem;
			outline: none;
			transition: all 0.3s ease;
			background: rgba(247, 250, 252, 0.8);
		}

		.tag-input:focus {
			border-color: #667eea;
			box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
			background: white;
		}

		.tag-input::placeholder {
			color: #a0aec0;
		}

		.empty-tags {
			color: #a0aec0;
			font-style: italic;
			padding: 15px;
			text-align: center;
			background: rgba(247, 250, 252, 0.5);
			border-radius: 15px;
			border: 2px dashed rgba(160, 174, 192, 0.3);
		}

		/* ë¶ë§ˆí¬ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
		.btn-bookmark {
			background: linear-gradient(135deg, #f6ad55, #ed8936);
			color: white;
			margin-bottom: 20px;
			display: flex;
			align-items: center;
			justify-content: center;
			gap: 8px;
			transition: all 0.3s ease;
		}

		.btn-bookmark:hover {
			background: linear-gradient(135deg, #ed8936, #dd6b20);
			transform: translateY(-2px);
			box-shadow: 0 8px 25px rgba(237, 137, 54, 0.4);
		}

		.btn-bookmark.bookmarked {
			background: linear-gradient(135deg, #48bb78, #38a169);
		}

		.btn-bookmark.bookmarked:hover {
			background: linear-gradient(135deg, #38a169, #2f855a);
			box-shadow: 0 8px 25px rgba(72, 187, 120, 0.4);
		}

		.btn-bookmark i {
			font-size: 1.1rem;
		}

		/* ì•¡ì…˜ ë²„íŠ¼ë“¤ */
		.action-buttons {
			display: flex;
			gap: 15px;
			justify-content: center;
			flex-wrap: wrap;
			margin-top: 40px;
		}

		.btn {
			padding: 12px 24px;
			border: none;
			border-radius: 25px;
			font-size: 1rem;
			font-weight: 600;
			cursor: pointer;
			transition: all 0.3s ease;
			text-decoration: none;
			display: inline-flex;
			align-items: center;
			gap: 8px;
			box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
		}

		.btn-primary {
			background: linear-gradient(135deg, #667eea, #764ba2);
			color: white;
		}

		.btn-secondary {
			background: linear-gradient(135deg, #718096, #4a5568);
			color: white;
		}

		.btn-danger {
			background: linear-gradient(135deg, #f56565, #e53e3e);
			color: white;
		}

		.btn:hover {
			transform: translateY(-2px);
			box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
			text-decoration: none;
			color: white;
		}

		.btn:active {
			transform: translateY(0);
		}

		/* ë’¤ë¡œê°€ê¸° ë§í¬ */
		.back-link {
			display: inline-flex;
			align-items: center;
			gap: 8px;
			color: rgba(255, 255, 255, 0.9);
			text-decoration: none;
			font-size: 1rem;
			font-weight: 600;
			margin-bottom: 20px;
			transition: all 0.3s ease;
		}

		.back-link:hover {
			color: white;
			text-decoration: none;
			transform: translateX(-5px);
		}

		/* í† ìŠ¤íŠ¸ ë©”ì‹œì§€ */
		.toast {
			position: fixed;
			top: 20px;
			right: 20px;
			background: #10b981;
			color: white;
			padding: 12px 20px;
			border-radius: 10px;
			box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
			z-index: 10000;
			font-size: 14px;
			opacity: 0;
			transform: translateX(100%);
			transition: all 0.3s ease;
		}

		.toast.show {
			opacity: 1;
			transform: translateX(0);
		}

		/* ë°˜ì‘í˜• ë””ìì¸ */
		@media (max-width: 768px) {
			.detail-container {
				padding: 20px 15px;
			}

			.snippet-header,
			.snippet-content,
			.snippet-info,
			.snippet-tags-section {
				padding: 20px;
			}

			.snippet-title {
				font-size: 1.8rem;
			}

			.header-top {
				flex-direction: column;
				gap: 15px;
				align-items: flex-start;
			}

			.snippet-meta {
				flex-direction: column;
				align-items: flex-start;
				gap: 10px;
			}

			.action-buttons {
				flex-direction: column;
			}

			.btn {
				width: 100%;
				justify-content: center;
			}

			.snippet-tags-input {
				flex-direction: column;
			}

			.tag-input {
				min-width: auto;
				width: 100%;
			}
		}
	</style>
</head>

<body>
	<div th:replace="fragments/sidebar :: sidebar('bookmarks')"></div>
	<div th:replace="fragments/header :: header"></div>

	<main class="main-content">
		<div class="detail-container">
			<!-- ë’¤ë¡œê°€ê¸° ë§í¬ -->
			<a href="/snippets" class="back-link">
				<i class="fas fa-arrow-left"></i>
				ìŠ¤ë‹ˆí« ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°
			</a>

			<!-- í—¤ë” ì˜ì—­ -->
			<div class="snippet-header">
				<div class="header-top">
					<div>
						<h1 class="snippet-title"
							th:text="${snippet.memo != null and !snippet.memo.isEmpty() ? snippet.memo : 'ì œëª© ì—†ëŠ” ìŠ¤ë‹ˆí«'}">
							ìŠ¤ë‹ˆí« ì œëª©</h1>
						<div class="snippet-meta">
							<span class="type-badge"
								th:classappend="${snippet.type.name().toLowerCase()} == 'code' ? 'type-code' : (${snippet.type.name().toLowerCase()} == 'text' ? 'type-text' : 'type-img')"
								th:text="${snippet.type.name().toUpperCase()}">TYPE</span>
							<span class="meta-item">
								<i class="fas fa-calendar-alt"></i>
								<span th:text="${#dates.format(snippet.createdAt, 'yyyyë…„ MMì›” ddì¼')}">ìƒì„±ì¼</span>
							</span>
							<span class="meta-item" th:if="${snippet.updatedAt != null}">
								<i class="fas fa-edit"></i>
								<span th:text="${#dates.format(snippet.updatedAt, 'yyyyë…„ MMì›” ddì¼')}">ìˆ˜ì •ì¼</span>
							</span>
							<span class="meta-item" th:if="${snippet.language != null and !snippet.language.isEmpty()}">
								<i class="fas fa-code"></i>
								<span th:text="${snippet.language}">ì–¸ì–´</span>
							</span>
						</div>
					</div>
					<div class="snippet-id-badge" th:text="'#' + ${snippet.snippetId}">#123</div>
				</div>
			</div>

			<!-- ë©”ì¸ ì½˜í…ì¸  ì˜ì—­ -->
			<div class="snippet-content">
				<!-- CODE íƒ€ì… -->
				<div th:if="${snippet.type.name().toLowerCase() == 'code'}">
					<div class="content-header">
						<h2 class="content-title">
							<i class="fas fa-code"></i>
							ì½”ë“œ ë‚´ìš©
						</h2>
						<button class="copy-btn" onclick="copyCode()">
							<i class="fas fa-copy"></i>
							ë³µì‚¬
						</button>
					</div>
					<div class="code-container">
						<div class="code-header">
							<span class="language-badge"
								th:text="${snippet.language != null ? snippet.language : 'Code'}">Language</span>
						</div>
						<div class="code-content">
							<pre><code th:text="${snippet.content != null ? snippet.content : 'ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.'}" id="codeContent" th:class="'language-' + ${snippet.language != null ? snippet.language.toLowerCase() : 'javascript'}">ì½”ë“œ ë‚´ìš©</code></pre>
						</div>
					</div>
				</div>

				<!-- TEXT íƒ€ì… -->
				<div th:if="${snippet.type.name().toLowerCase() == 'text'}">
					<div class="content-header">
						<h2 class="content-title">
							<i class="fas fa-file-text"></i>
							í…ìŠ¤íŠ¸ ë‚´ìš©
						</h2>
						<button class="copy-btn" onclick="copyText()">
							<i class="fas fa-copy"></i>
							ë³µì‚¬
						</button>
					</div>
					<div class="text-content" id="textContent">
						<span th:text="${snippet.content != null ? snippet.content : 'ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.'}">í…ìŠ¤íŠ¸ ë‚´ìš©</span>
					</div>
				</div>

				<!-- IMG íƒ€ì… -->
				<div th:if="${snippet.type.name().toLowerCase() == 'img'}">
					<div class="content-header">
						<h2 class="content-title">
							<i class="fas fa-image"></i>
							ì´ë¯¸ì§€
						</h2>
						<button class="copy-btn" onclick="copyImageUrl()" th:if="${snippet.imageUrl != null}">
							<i class="fas fa-link"></i>
							URL ë³µì‚¬
						</button>
					</div>
					<div class="image-container">
						<img th:if="${snippet.imageUrl != null and !snippet.imageUrl.isEmpty()}"
							th:src="${snippet.imageUrl}"
							th:alt="${snippet.altText != null ? snippet.altText : 'ìŠ¤ë‹ˆí« ì´ë¯¸ì§€'}" class="snippet-image"
							id="snippetImage" />
						<div th:if="${snippet.imageUrl == null or snippet.imageUrl.isEmpty()}"
							style="padding: 60px; text-align: center; color: #718096; font-size: 1.2rem;">
							<i class="fas fa-image" style="font-size: 3rem; margin-bottom: 20px; opacity: 0.3;"></i>
							<p>ì´ë¯¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
						</div>
						<div th:if="${snippet.altText != null and !snippet.altText.isEmpty()}" class="image-alt-text"
							th:text="${snippet.altText}">ì´ë¯¸ì§€ ì„¤ëª…</div>
					</div>
				</div>

				<!-- ëª¨ë“  íƒ€ì…ì— ëŒ€í•œ fallback -->
				<div th:if="${snippet.type == null}">
					<div class="content-header">
						<h2 class="content-title">
							<i class="fas fa-question-circle"></i>
							ë‚´ìš©
						</h2>
					</div>
					<div style="padding: 40px; text-align: center; color: #718096;">
						<p>ìŠ¤ë‹ˆí« íƒ€ì…ì„ í™•ì¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
						<p>íƒ€ì…: <span th:text="${snippet.type}">Unknown</span></p>
					</div>
				</div>
			</div>

			<!-- ì¶”ê°€ ì •ë³´ -->
			<div class="snippet-info" th:if="${snippet.sourceUrl != null or snippet.visibility != null}">
				<div class="info-grid">
					<div class="info-item" th:if="${snippet.sourceUrl != null and !snippet.sourceUrl.isEmpty()}">
						<div class="info-label">ì¶œì²˜ URL</div>
						<div class="info-value">
							<a th:href="${snippet.sourceUrl}" th:text="${snippet.sourceUrl}" target="_blank"
								style="color: #667eea; text-decoration: none;">URL</a>
						</div>
					</div>
					<div class="info-item" th:if="${snippet.visibility != null}">
						<div class="info-label">ê³µê°œ ì„¤ì •</div>
						<div class="info-value" th:text="${snippet.visibility == 1 ? 'ê³µê°œ' : 'ë¹„ê³µê°œ'}">ê³µê°œ ì„¤ì •</div>
					</div>
				</div>
			</div>

			<!-- íƒœê·¸ ì„¹ì…˜ -->
			<div class="snippet-tags-section">
				<h4>ğŸ·ï¸ íƒœê·¸</h4>
				<div class="snippet-tags-display" id="snippetTagsDisplay">
					<div class="empty-tags" id="emptyTagsMessage">
						ì•„ì§ íƒœê·¸ê°€ ì—†ìŠµë‹ˆë‹¤. ì•„ë˜ì—ì„œ íƒœê·¸ë¥¼ ì¶”ê°€í•´ë³´ì„¸ìš”!
					</div>
				</div>
				<div class="snippet-tags-input">
					<input type="text" id="tagInput" placeholder="íƒœê·¸ ì¶”ê°€ (ì‰¼í‘œë¡œ êµ¬ë¶„)" class="tag-input">
					<button id="addTagsBtn" class="btn btn-primary">íƒœê·¸ ì¶”ê°€</button>
				</div>
			</div>

			<!-- ë¶ë§ˆí¬ ë²„íŠ¼ -->
			<button id="bookmarkToggleBtn" class="btn btn-bookmark">
				<i class="fas fa-bookmark"></i> 
				<span class="bookmark-text">ë¶ë§ˆí¬ ì¶”ê°€</span>
			</button>

			<!-- ì•¡ì…˜ ë²„íŠ¼ë“¤ -->
			<div class="action-buttons">
				<form
					th:action="@{/snippets/edit-form/{type}/{snippetId}(type=${snippet.type}, snippetId=${snippet.snippetId})}"
					method="get" style="display: inline;">
					<button type="submit" class="btn btn-primary">
						<i class="fas fa-edit"></i>
						ìˆ˜ì •í•˜ê¸°
					</button>
				</form>

				<form th:action="@{/snippets/delete/{snippetId}(snippetId=${snippet.snippetId})}" method="post"
					onsubmit="return confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');" style="display: inline;">
					<button type="submit" class="btn btn-danger">
						<i class="fas fa-trash"></i>
						ì‚­ì œí•˜ê¸°
					</button>
				</form>
			</div>
		</div>
	</main>

	<script th:inline="javascript">
		// ì „ì—­ ë³€ìˆ˜
		let currentTags = [];
		let isBookmarked = false;
		const snippetId = /*[[${snippet.snippetId}]]*/ 1;
		const csrfToken  = /*[[${_csrf.token}]]*/ '';
		const csrfHeader = /*[[${_csrf.headerName}]]*/ '';
		

		// í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
		document.addEventListener('DOMContentLoaded', () => {
		      loadTags();
		      loadBookmarkStatus();
		      document.getElementById('addTagsBtn').addEventListener('click', addTags);
		      document.getElementById('tagInput').addEventListener('keypress', e => {
		        if (e.key === 'Enter') addTags();
		      });
		      document.getElementById('bookmarkToggleBtn').addEventListener('click', toggleBookmark);
		    });

		    // íƒœê·¸ ê´€ë¦¬ í•¨ìˆ˜ë“¤ - ì‹¤ì œ ì‚¬ìš© ê°€ëŠ¥í•œ API ì—”ë“œí¬ì¸íŠ¸ í™•ì¸ í›„ ìˆ˜ì •
		    function loadTags() {
		      // 1ì°¨ ì‹œë„: ê¸°ë³¸ íƒœê·¸ API
		      fetch(`/api/tags/snippet/${snippetId}`, {
		        method: 'GET',
		        credentials: 'same-origin'
		      })
		      .then(res => {
		        console.log('íƒœê·¸ API ì‘ë‹µ ìƒíƒœ (1ì°¨):', res.status);
		        if (res.ok) {
		          return res.json();
		        }
		        // 1ì°¨ ì‹¤íŒ¨ ì‹œ 2ì°¨ ì‹œë„
		        throw new Error(`First attempt failed: ${res.status}`);
		      })
		      .then(data => {
		        console.log('íƒœê·¸ API ì‘ë‹µ ë°ì´í„° (1ì°¨):', data);
		        processTags(data);
		      })
		      .catch(err => {
		        console.log('1ì°¨ íƒœê·¸ API ì‹¤íŒ¨, 2ì°¨ ì‹œë„:', err.message);
		        
		        // 2ì°¨ ì‹œë„: ë‹¤ë¥¸ ì—”ë“œí¬ì¸íŠ¸
		        fetch(`/snippets/${snippetId}/tags`, {
		          method: 'GET',
		          credentials: 'same-origin'
		        })
		        .then(res => {
		          console.log('íƒœê·¸ API ì‘ë‹µ ìƒíƒœ (2ì°¨):', res.status);
		          if (res.ok) {
		            return res.json();
		          }
		          throw new Error(`Second attempt failed: ${res.status}`);
		        })
		        .then(data => {
		          console.log('íƒœê·¸ API ì‘ë‹µ ë°ì´í„° (2ì°¨):', data);
		          processTags(data);
		        })
		        .catch(err2 => {
		          console.log('2ì°¨ íƒœê·¸ APIë„ ì‹¤íŒ¨, 3ì°¨ ì‹œë„:', err2.message);
		          
		          // 3ì°¨ ì‹œë„: ê¸°ì¡´ íƒœê·¸ í‘œì‹œ ìŠ¤í‚µ, ë¹ˆ ë°°ì—´ë¡œ ì´ˆê¸°í™”
		          console.error('ëª¨ë“  íƒœê·¸ API ì‹œë„ ì‹¤íŒ¨:', err2);
		          currentTags = [];
		          displayTags();
		          showToast('íƒœê·¸ ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
		        });
		      });
		    }

		    function processTags(data) {
		      // ì‘ë‹µ í˜•íƒœì— ë”°ë¼ ì²˜ë¦¬
		      if (Array.isArray(data)) {
		        currentTags = data;
		      } else if (data && Array.isArray(data.tags)) {
		        currentTags = data.tags;
		      } else if (data && data.success && Array.isArray(data.data)) {
		        currentTags = data.data;
		      } else {
		        console.warn('ì˜ˆìƒí•˜ì§€ ëª»í•œ íƒœê·¸ API ì‘ë‹µ í˜•íƒœ:', data);
		        currentTags = [];
		      }
		      displayTags();
		    }

		    function displayTags() {
		      const container = document.getElementById('snippetTagsDisplay');
		      const emptyMessage = document.getElementById('emptyTagsMessage');
		      
		      // currentTagsê°€ ë°°ì—´ì¸ì§€ í™•ì¸
		      if (!Array.isArray(currentTags)) {
		        console.warn('currentTagsê°€ ë°°ì—´ì´ ì•„ë‹™ë‹ˆë‹¤:', currentTags);
		        currentTags = [];
		      }
		      
		      if (currentTags.length === 0) {
		        if (emptyMessage) {
		          emptyMessage.style.display = 'block';
		        } else {
		          container.innerHTML = '<div class="empty-tags">ì•„ì§ íƒœê·¸ê°€ ì—†ìŠµë‹ˆë‹¤. ì•„ë˜ì—ì„œ íƒœê·¸ë¥¼ ì¶”ê°€í•´ë³´ì„¸ìš”!</div>';
		        }
		        return;
		      }

		      if (emptyMessage) {
		        emptyMessage.style.display = 'none';
		      }

		      const tagsHtml = currentTags.map(tag => {
		        // tag ê°ì²´ êµ¬ì¡° í™•ì¸
		        const tagId = tag.tagId || tag.id;
		        const tagName = tag.name || tag.tagName || String(tag);
		        
		        return `
		          <span class="tag-badge" data-tag-id="${tagId}">
		            ${escapeHtml(tagName)}
		            <button class="tag-remove" onclick="removeTag(${tagId})" title="íƒœê·¸ ì œê±°">Ã—</button>
		          </span>
		        `;
		      }).join('');
		      
		      container.innerHTML = tagsHtml;
		    }

		    async function addTags() {
		      const input = document.getElementById('tagInput');
		      const inputValue = input.value.trim();
		      
		      if (!inputValue) {
		        showToast('íƒœê·¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
		        return;
		      }

		      const tagNames = inputValue.split(',')
		        .map(name => name.trim())
		        .filter(name => name && !currentTags.some(tag => {
		          const tagName = tag.name || tag.tagName || String(tag);
		          return tagName === name;
		        }));
		      
		      if (tagNames.length === 0) {
		        showToast('ìƒˆë¡œìš´ íƒœê·¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
		        return;
		      }

		      try {
		        // 1ì°¨ ì‹œë„: REST API ë°©ì‹
		        await addTagsViaAPI(tagNames);
		        
		      } catch (error) {
		        console.error('API ë°©ì‹ íƒœê·¸ ì¶”ê°€ ì‹¤íŒ¨:', error);
		        
		        try {
		          // 2ì°¨ ì‹œë„: í¼ ë°©ì‹ìœ¼ë¡œ íƒœê·¸ ì¶”ê°€
		          await addTagsViaForm(tagNames);
		          
		        } catch (error2) {
		          console.error('í¼ ë°©ì‹ íƒœê·¸ ì¶”ê°€ë„ ì‹¤íŒ¨:', error2);
		          showToast('íƒœê·¸ ì¶”ê°€ ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
		        }
		      }
		    }

		    async function addTagsViaAPI(tagNames) {
		      for (const tagName of tagNames) {
		        console.log('API ë°©ì‹ íƒœê·¸ ì¶”ê°€ ì‹œë„:', tagName);
		        
		        // 1) íƒœê·¸ ìƒì„± ì‹œë„
		        const createResponse = await fetch('/api/tags', {
		          method: 'POST',
		          credentials: 'same-origin',
		          headers: {
		            'Content-Type': 'application/json',
		            [csrfHeader]: csrfToken
		          },
		          body: JSON.stringify({ name: tagName })
		        });

		        let tag;
		        if (createResponse.ok) {
		          const createResult = await createResponse.json();
		          tag = createResult.tag || createResult;
		        } else {
		          // íƒœê·¸ ìƒì„± ì‹¤íŒ¨ ì‹œ ê¸°ì¡´ íƒœê·¸ ê²€ìƒ‰ ì‹œë„
		          const searchResponse = await fetch(`/api/tags?name=${encodeURIComponent(tagName)}`, {
		            method: 'GET',
		            credentials: 'same-origin'
		          });
		          
		          if (searchResponse.ok) {
		            const searchResult = await searchResponse.json();
		            tag = Array.isArray(searchResult) ? searchResult[0] : searchResult;
		          } else {
		            throw new Error(`íƒœê·¸ ìƒì„±/ì¡°íšŒ ì‹¤íŒ¨: ${tagName}`);
		          }
		        }

		        const tagId = tag.tagId || tag.id;
		        if (!tagId) {
		          throw new Error(`íƒœê·¸ IDë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ${tagName}`);
		        }

		        // 2) ìŠ¤ë‹ˆí«-íƒœê·¸ ë§¤í•‘ ì‹œë„
		        const linkResponse = await fetch(`/api/tags/snippet/${snippetId}/tag/${tagId}`, {
		          method: 'POST',
		          credentials: 'same-origin',
		          headers: {
		            [csrfHeader]: csrfToken
		          }
		        });

		        if (!linkResponse.ok) {
		          // ë‹¤ë¥¸ ë§¤í•‘ ì—”ë“œí¬ì¸íŠ¸ ì‹œë„
		          const link2Response = await fetch(`/snippets/${snippetId}/addTag`, {
		            method: 'POST',
		            credentials: 'same-origin',
		            headers: {
		              'Content-Type': 'application/x-www-form-urlencoded',
		              [csrfHeader]: csrfToken
		            },
		            body: new URLSearchParams({ tagId: tagId })
		          });
		          
		          if (!link2Response.ok) {
		            throw new Error(`íƒœê·¸ ë§¤í•‘ ì‹¤íŒ¨: ${tagName}`);
		          }
		        }
		        
		        console.log('API ë°©ì‹ íƒœê·¸ ë§¤í•‘ ì„±ê³µ:', tagName);
		      }

		      // ì„±ê³µ ì‹œ ì²˜ë¦¬
		      document.getElementById('tagInput').value = '';
		      await loadTags();
		      showToast(`${tagNames.length}ê°œ íƒœê·¸ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.`);
		    }

		    async function addTagsViaForm(tagNames) {
		      // í¼ ê¸°ë°˜ íƒœê·¸ ì¶”ê°€ (ì„œë²„ ì‚¬ì´ë“œ ì²˜ë¦¬)
		      for (const tagName of tagNames) {
		        console.log('í¼ ë°©ì‹ íƒœê·¸ ì¶”ê°€ ì‹œë„:', tagName);
		        
		        const formData = new FormData();
		        formData.append('snippetId', snippetId);
		        formData.append('tagName', tagName);
		        formData.append('_csrf', csrfToken);

		        const response = await fetch('/snippets/addTag', {
		          method: 'POST',
		          credentials: 'same-origin',
		          body: formData
		        });

		        if (!response.ok) {
		          throw new Error(`í¼ ë°©ì‹ íƒœê·¸ ì¶”ê°€ ì‹¤íŒ¨: ${tagName} (${response.status})`);
		        }
		        
		        console.log('í¼ ë°©ì‹ íƒœê·¸ ì¶”ê°€ ì„±ê³µ:', tagName);
		      }

		      // ì„±ê³µ ì‹œ ì²˜ë¦¬
		      document.getElementById('tagInput').value = '';
		      await loadTags();
		      showToast(`${tagNames.length}ê°œ íƒœê·¸ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.`);
		    }

		    async function removeTag(tagId) {
		      if (!tagId) {
		        showToast('íƒœê·¸ IDê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
		        return;
		      }
		      
		      if (!confirm('ì´ íƒœê·¸ë¥¼ ì œê±°í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
		        return;
		      }

		      try {
		        console.log('íƒœê·¸ ì œê±° ì‹œë„:', tagId);
		        
		        // 1ì°¨ ì‹œë„: REST API ë°©ì‹
		        await removeTagViaAPI(tagId);
		        
		      } catch (error) {
		        console.error('API ë°©ì‹ íƒœê·¸ ì œê±° ì‹¤íŒ¨:', error);
		        
		        try {
		          // 2ì°¨ ì‹œë„: í¼ ë°©ì‹
		          await removeTagViaForm(tagId);
		          
		        } catch (error2) {
		          console.error('í¼ ë°©ì‹ íƒœê·¸ ì œê±°ë„ ì‹¤íŒ¨:', error2);
		          showToast('íƒœê·¸ ì œê±° ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
		        }
		      }
		    }

		    async function removeTagViaAPI(tagId) {
		      // 1ì°¨ ì‹œë„: DELETE ë°©ì‹
		      let response = await fetch(`/api/tags/snippet/${snippetId}/tag/${tagId}`, {
		        method: 'DELETE',
		        credentials: 'same-origin',
		        headers: {
		          [csrfHeader]: csrfToken
		        }
		      });

		      if (!response.ok) {
		        // 2ì°¨ ì‹œë„: ë‹¤ë¥¸ ì—”ë“œí¬ì¸íŠ¸
		        response = await fetch(`/snippets/${snippetId}/removeTag`, {
		          method: 'POST',
		          credentials: 'same-origin',
		          headers: {
		            'Content-Type': 'application/x-www-form-urlencoded',
		            [csrfHeader]: csrfToken
		          },
		          body: new URLSearchParams({ tagId: tagId })
		        });
		      }

		      if (!response.ok) {
		        throw new Error(`íƒœê·¸ ì œê±° ì‹¤íŒ¨ (${response.status})`);
		      }

		      const result = await response.json().catch(() => ({}));
		      console.log('API ë°©ì‹ íƒœê·¸ ì œê±° ê²°ê³¼:', result);
		      
		      // ì„±ê³µ ì²˜ë¦¬
		      currentTags = currentTags.filter(tag => {
		        const currentTagId = tag.tagId || tag.id;
		        return currentTagId != tagId;
		      });
		      displayTags();
		      showToast('íƒœê·¸ê°€ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤.');
		    }

		    async function removeTagViaForm(tagId) {
		      const formData = new FormData();
		      formData.append('snippetId', snippetId);
		      formData.append('tagId', tagId);
		      formData.append('_csrf', csrfToken);

		      const response = await fetch('/snippets/removeTag', {
		        method: 'POST',
		        credentials: 'same-origin',
		        body: formData
		      });

		      if (!response.ok) {
		        throw new Error(`í¼ ë°©ì‹ íƒœê·¸ ì œê±° ì‹¤íŒ¨ (${response.status})`);
		      }
		      
		      console.log('í¼ ë°©ì‹ íƒœê·¸ ì œê±° ì„±ê³µ');
		      
		      // ì„±ê³µ ì²˜ë¦¬
		      currentTags = currentTags.filter(tag => {
		        const currentTagId = tag.tagId || tag.id;
		        return currentTagId != tagId;
		      });
		      displayTags();
		      showToast('íƒœê·¸ê°€ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤.');
		    }

		    // ë¶ë§ˆí¬ ê´€ë¦¬ í•¨ìˆ˜ë“¤ - ì—¬ëŸ¬ ì—”ë“œí¬ì¸íŠ¸ ì‹œë„ë¡œ í˜¸í™˜ì„± í™•ë³´
		    function loadBookmarkStatus() {
		      // 1ì°¨ ì‹œë„: BookmarkRestController ì—”ë“œí¬ì¸íŠ¸
		      fetch(`/api/bookmarks/check/${snippetId}`, {
		        method: 'GET',
		        credentials: 'same-origin'
		      })
		      .then(response => {
		        console.log('ë¶ë§ˆí¬ API ì‘ë‹µ ìƒíƒœ (1ì°¨):', response.status);
		        if (response.ok) {
		          return response.json();
		        }
		        throw new Error(`First bookmark attempt failed: ${response.status}`);
		      })
		      .then(data => {
		        console.log('ë¶ë§ˆí¬ API ì‘ë‹µ ë°ì´í„° (1ì°¨):', data);
		        processBookmarkStatus(data);
		      })
		      .catch(error => {
		        console.log('1ì°¨ ë¶ë§ˆí¬ API ì‹¤íŒ¨, 2ì°¨ ì‹œë„:', error.message);
		        
		        // 2ì°¨ ì‹œë„: ë‹¤ë¥¸ ì—”ë“œí¬ì¸íŠ¸
		        fetch(`/bookmarks/check?snippetId=${snippetId}`, {
		          method: 'GET',
		          credentials: 'same-origin'
		        })
		        .then(response => {
		          console.log('ë¶ë§ˆí¬ API ì‘ë‹µ ìƒíƒœ (2ì°¨):', response.status);
		          if (response.ok) {
		            return response.json();
		          }
		          throw new Error(`Second bookmark attempt failed: ${response.status}`);
		        })
		        .then(data => {
		          console.log('ë¶ë§ˆí¬ API ì‘ë‹µ ë°ì´í„° (2ì°¨):', data);
		          processBookmarkStatus(data);
		        })
		        .catch(error2 => {
		          console.log('2ì°¨ ë¶ë§ˆí¬ APIë„ ì‹¤íŒ¨, 3ì°¨ ì‹œë„:', error2.message);
		          
		          // 3ì°¨ ì‹œë„: ì„¸ì…˜ ê¸°ë°˜ í™•ì¸
		          fetch(`/snippets/${snippetId}/bookmarkStatus`, {
		            method: 'GET',
		            credentials: 'same-origin'
		          })
		          .then(response => {
		            console.log('ë¶ë§ˆí¬ API ì‘ë‹µ ìƒíƒœ (3ì°¨):', response.status);
		            if (response.ok) {
		              return response.json();
		            }
		            throw new Error(`Third bookmark attempt failed: ${response.status}`);
		          })
		          .then(data => {
		            console.log('ë¶ë§ˆí¬ API ì‘ë‹µ ë°ì´í„° (3ì°¨):', data);
		            processBookmarkStatus(data);
		          })
		          .catch(error3 => {
		            console.error('ëª¨ë“  ë¶ë§ˆí¬ API ì‹œë„ ì‹¤íŒ¨:', error3);
		            isBookmarked = false;
		            updateBookmarkButton();
		            showToast('ë¶ë§ˆí¬ ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
		          });
		        });
		      });
		    }

		    function processBookmarkStatus(data) {
		      // BookmarkRestControllerì˜ ì‘ë‹µ í˜•íƒœ: { "success": true, "isBookmarked": boolean }
		      if (data && data.success && typeof data.isBookmarked === 'boolean') {
		        isBookmarked = data.isBookmarked;
		      } else if (typeof data === 'boolean') {
		        isBookmarked = data;
		      } else if (data && typeof data.bookmarked === 'boolean') {
		        isBookmarked = data.bookmarked;
		      } else {
		        console.warn('ì˜ˆìƒí•˜ì§€ ëª»í•œ ë¶ë§ˆí¬ API ì‘ë‹µ í˜•íƒœ:', data);
		        isBookmarked = false;
		      }
		      updateBookmarkButton();
		    }

		    async function toggleBookmark() {
		      try {
		        console.log('ë¶ë§ˆí¬ í† ê¸€ ì‹œë„ - ìŠ¤ë‹ˆí« ID:', snippetId);
		        
		        const response = await fetch('/api/bookmarks/toggle', {
		          method: 'POST',
		          credentials: 'same-origin',
		          headers: {
		            'Content-Type': 'application/x-www-form-urlencoded',
		            [csrfHeader]: csrfToken
		          },
		          body: new URLSearchParams({ snippetId: snippetId.toString() })
		        });

		        console.log('ë¶ë§ˆí¬ í† ê¸€ ì‘ë‹µ ìƒíƒœ:', response.status);

		        if (!response.ok) {
		          if (response.status === 401) {
		            showToast('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
		            return;
		          }
		          const errorText = await response.text();
		          console.error('ë¶ë§ˆí¬ í† ê¸€ ì‘ë‹µ ì˜¤ë¥˜:', response.status, errorText);
		          throw new Error(`ë¶ë§ˆí¬ ì²˜ë¦¬ ì‹¤íŒ¨ (${response.status})`);
		        }

		        const result = await response.json();
		        console.log('ë¶ë§ˆí¬ í† ê¸€ ê²°ê³¼:', result);
		        
		        // BookmarkRestControllerì˜ ì‘ë‹µ í˜•íƒœ: { "success": true, "bookmarked": boolean, "message": string }
		        if (result.success) {
		          isBookmarked = result.bookmarked;
		          updateBookmarkButton();
		          showToast(result.message || (isBookmarked ? 'ë¶ë§ˆí¬ì— ì¶”ê°€í–ˆìŠµë‹ˆë‹¤.' : 'ë¶ë§ˆí¬ì—ì„œ ì œê±°í–ˆìŠµë‹ˆë‹¤.'));
		        } else {
		          throw new Error(result.message || 'ë¶ë§ˆí¬ ì²˜ë¦¬ ì‹¤íŒ¨');
		        }
		        
		      } catch (error) {
		        console.error('ë¶ë§ˆí¬ í† ê¸€ ì‹¤íŒ¨:', error);
		        showToast(`ë¶ë§ˆí¬ ì²˜ë¦¬ ì‹¤íŒ¨: ${error.message}`);
		      }
		    }

		    function updateBookmarkButton() {
		      const btn = document.getElementById('bookmarkToggleBtn');
		      const text = btn.querySelector('.bookmark-text');
		      const icon = btn.querySelector('i');
		      
		      if (isBookmarked) {
		        btn.classList.add('bookmarked');
		        text.textContent = 'ë¶ë§ˆí¬ ì œê±°';
		        icon.className = 'fas fa-bookmark'; // ì±„ì›Œì§„ ë¶ë§ˆí¬ ì•„ì´ì½˜
		      } else {
		        btn.classList.remove('bookmarked');
		        text.textContent = 'ë¶ë§ˆí¬ ì¶”ê°€';
		        icon.className = 'far fa-bookmark'; // ë¹ˆ ë¶ë§ˆí¬ ì•„ì´ì½˜
		      }
		    }

		    // ë¶ë§ˆí¬ ìƒíƒœ ë³€ê²½ ê°ì§€ë¥¼ ìœ„í•œ ì¶”ê°€ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤
		    function addBookmark() {
		      if (isBookmarked) {
		        showToast('ì´ë¯¸ ë¶ë§ˆí¬ëœ ìŠ¤ë‹ˆí«ì…ë‹ˆë‹¤.');
		        return;
		      }
		      
		      fetch('/api/bookmarks', {
		        method: 'POST',
		        credentials: 'same-origin',
		        headers: {
		          'Content-Type': 'application/json',
		          [csrfHeader]: csrfToken
		        },
		        body: JSON.stringify({ snippetId: snippetId })
		      })
		      .then(response => response.json())
		      .then(result => {
		        if (result.success) {
		          isBookmarked = true;
		          updateBookmarkButton();
		          showToast(result.message);
		        } else {
		          showToast(result.message);
		        }
		      })
		      .catch(error => {
		        console.error('ë¶ë§ˆí¬ ì¶”ê°€ ì‹¤íŒ¨:', error);
		        showToast('ë¶ë§ˆí¬ ì¶”ê°€ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
		      });
		    }

		    function removeBookmark() {
		      if (!isBookmarked) {
		        showToast('ë¶ë§ˆí¬ë˜ì§€ ì•Šì€ ìŠ¤ë‹ˆí«ì…ë‹ˆë‹¤.');
		        return;
		      }
		      
		      fetch(`/api/bookmarks/${snippetId}`, {
		        method: 'DELETE',
		        credentials: 'same-origin',
		        headers: {
		          [csrfHeader]: csrfToken
		        }
		      })
		      .then(response => response.json())
		      .then(result => {
		        if (result.success) {
		          isBookmarked = false;
		          updateBookmarkButton();
		          showToast(result.message);
		        } else {
		          showToast(result.message);
		        }
		      })
		      .catch(error => {
		        console.error('ë¶ë§ˆí¬ ì œê±° ì‹¤íŒ¨:', error);
		        showToast('ë¶ë§ˆí¬ ì œê±° ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
		      });
		    }

		// ë³µì‚¬ ê¸°ëŠ¥ë“¤ (bookmark-dynamic-loader.jsì˜ copyToClipboard í•¨ìˆ˜ì™€ í˜¸í™˜)
		async function copyCode() {
			const codeElement = document.getElementById('codeContent');
			if (codeElement) {
				const codeContent = codeElement.textContent || codeElement.innerText;
				await copyToClipboard(codeContent, 'ì½”ë“œê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
			} else {
				showToast('ë³µì‚¬í•  ì½”ë“œê°€ ì—†ìŠµë‹ˆë‹¤.');
			}
		}

		async function copyText() {
			const textElement = document.getElementById('textContent');
			if (textElement) {
				const textContent = textElement.textContent || textElement.innerText;
				await copyToClipboard(textContent, 'í…ìŠ¤íŠ¸ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
			} else {
				showToast('ë³µì‚¬í•  í…ìŠ¤íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.');
			}
		}

		async function copyImageUrl() {
			const imageElement = document.getElementById('snippetImage');
			if (imageElement && imageElement.src) {
				await copyToClipboard(imageElement.src, 'ì´ë¯¸ì§€ URLì´ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
			} else {
				showToast('ë³µì‚¬í•  ì´ë¯¸ì§€ URLì´ ì—†ìŠµë‹ˆë‹¤.');
			}
		}

		// í´ë¦½ë³´ë“œ ë³µì‚¬ í•¨ìˆ˜ (bookmark-dynamic-loader.jsì™€ ë™ì¼í•œ êµ¬í˜„)
		async function copyToClipboard(text, successMessage) {
			if (navigator.clipboard) {
				try {
					await navigator.clipboard.writeText(text);
					showToast(successMessage || 'í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
				} catch (err) {
					console.error('í´ë¦½ë³´ë“œ ë³µì‚¬ ì‹¤íŒ¨:', err);
					fallbackCopyToClipboard(text, successMessage);
				}
			} else {
				fallbackCopyToClipboard(text, successMessage);
			}
		}

		function fallbackCopyToClipboard(text, successMessage) {
			const textArea = document.createElement('textarea');
			textArea.value = text;
			textArea.style.position = 'fixed';
			textArea.style.left = '-999999px';
			textArea.style.top = '-999999px';
			document.body.appendChild(textArea);
			textArea.focus();
			textArea.select();
			
			try {
				document.execCommand('copy');
				showToast(successMessage || 'í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
			} catch (err) {
				console.error('í´ë°± ë³µì‚¬ ì‹¤íŒ¨:', err);
				showToast('ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
			}
			
			document.body.removeChild(textArea);
		}

		// í† ìŠ¤íŠ¸ ë©”ì‹œì§€ í‘œì‹œ (bookmark-dynamic-loader.jsì™€ ë™ì¼í•œ êµ¬í˜„)
		function showToast(message) {
			// ê¸°ì¡´ í† ìŠ¤íŠ¸ ì œê±°
			const existingToast = document.querySelector('.toast');
			if (existingToast) {
				existingToast.remove();
			}

			// ìƒˆ í† ìŠ¤íŠ¸ ìƒì„±
			const toast = document.createElement('div');
			toast.className = 'toast';
			toast.textContent = message;
			document.body.appendChild(toast);

			// ì• ë‹ˆë©”ì´ì…˜ìœ¼ë¡œ í‘œì‹œ
			setTimeout(() => {
				toast.classList.add('show');
			}, 100);

			// 3ì´ˆ í›„ ì œê±°
			setTimeout(() => {
				toast.classList.remove('show');
				setTimeout(() => {
					if (toast.parentNode) {
						toast.remove();
					}
				}, 300);
			}, 3000);
		}

		// HTML ì´ìŠ¤ì¼€ì´í”„ í•¨ìˆ˜ (bookmark-dynamic-loader.jsì™€ ë™ì¼)
		function escapeHtml(text) {
			if (!text) return '';
			const div = document.createElement('div');
			div.textContent = text;
			return div.innerHTML;
		}

		// ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤ (BookmarkRestControllerì™€ í˜¸í™˜)
		window.snippetDetailUtils = {
			showToast: showToast,
			copyToClipboard: copyToClipboard,
			escapeHtml: escapeHtml,
			// ë¶ë§ˆí¬ ìƒíƒœ í™•ì¸
			isBookmarked: () => isBookmarked,
			// ë¶ë§ˆí¬ ìƒíƒœ ìƒˆë¡œê³ ì¹¨
			refreshBookmarkStatus: loadBookmarkStatus,
			// íƒœê·¸ ìƒˆë¡œê³ ì¹¨
			refreshTags: loadTags,
			// ë¶ë§ˆí¬ ì§ì ‘ ì¡°ì‘ (ê³ ê¸‰ ì‚¬ìš©ììš©)
			addBookmark: addBookmark,
			removeBookmark: removeBookmark,
			toggleBookmark: toggleBookmark
		};

		// í˜ì´ì§€ ê°€ì‹œì„± ë³€ê²½ ì‹œ ë¶ë§ˆí¬ ìƒíƒœ ìƒˆë¡œê³ ì¹¨ (ì„ íƒì‚¬í•­)
		document.addEventListener('visibilitychange', () => {
		  if (!document.hidden) {
		    // í˜ì´ì§€ê°€ ë‹¤ì‹œ í™œì„±í™”ë˜ë©´ ë¶ë§ˆí¬ ìƒíƒœ ìƒˆë¡œê³ ì¹¨
		    setTimeout(loadBookmarkStatus, 500);
		  }
		});

		// ë¸Œë¼ìš°ì € í¬ì»¤ìŠ¤ ì‹œ ë¶ë§ˆí¬ ìƒíƒœ ìƒˆë¡œê³ ì¹¨ (ì„ íƒì‚¬í•­)
		window.addEventListener('focus', () => {
		  setTimeout(loadBookmarkStatus, 500);
		});
	</script>
</body>

</html>