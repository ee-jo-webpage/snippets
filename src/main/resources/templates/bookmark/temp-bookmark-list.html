<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <title>ë‚´ ë¶ë§ˆí¬</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link th:href="@{/bookmark/css/bookmark-list.css}" rel="stylesheet">
    <link th:href="@{/my-snippet-page/css/my-snippet-page.css}" rel="stylesheet">
    <link th:href="@{/snippet-section/css/snippet-section.css}" rel="stylesheet">
</head>
<body>

<!-- í—¤ë” í¬í•¨ -->
<div th:replace="fragments/header :: header"></div>

<!-- ì‚¬ì´ë“œë°” í¬í•¨ -->
<div th:replace="fragments/sidebar :: sidebar('bookmarks')"></div>

<!-- ë©”ì¸ ì»¨í…ì¸ ë¥¼ ì‚¬ì´ë“œë°”ê°€ ìˆëŠ” ë ˆì´ì•„ì›ƒì— ë§ê²Œ ì¡°ì • -->
<main class="main-content">
    <div class="container">
        <!-- ë¶ë§ˆí¬ ê´€ë¦¬ ë„¤ë¹„ê²Œì´ì…˜ -->
        <div class="bookmark-navigation" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
            <h2 style="margin: 0; color: #333;">ğŸ“š ë‚´ ë¶ë§ˆí¬</h2>
            <div style="display: flex; gap: 15px; align-items: center;">
                <a th:href="@{/snippets}"
                   style="text-decoration: none; color: #6c757d; padding: 8px 16px; border-radius: 4px; background: white; border: 1px solid #dee2e6;">
                    ğŸ“‹ ìŠ¤ë‹ˆí« ë‘˜ëŸ¬ë³´ê¸°
                </a>
                <div class="bookmark-count" th:text="|ì´ ${count}ê°œì˜ ë¶ë§ˆí¬|" style="color: #6c757d; font-size: 14px;">ì´ 0ê°œì˜ ë¶ë§ˆí¬</div>
            </div>
        </div>

        <!-- ì•Œë¦¼ ë©”ì‹œì§€ í‘œì‹œ ì˜ì—­ -->
        <div id="alertContainer"></div>
        <div th:if="${message}" class="alert alert-success" th:text="${message}"></div>
        <div th:if="${error}" class="alert alert-error" th:text="${error}"></div>

        <!-- ê²€ìƒ‰ ì„¹ì…˜ (ë¡œê·¸ì¸ëœ ê²½ìš°ì—ë§Œ í‘œì‹œ) -->
        <div th:if="${userId != null}" class="search-section">
            <div class="search-bar">
                <input type="text"
                       id="bookmarkSearchInput"
                       class="search-input"
                       placeholder="ë¶ë§ˆí¬ ê²€ìƒ‰ (ì œëª©, ë©”ëª¨, ìŠ¤ë‹ˆí« ID...)">
                <select id="bookmarkTypeFilter" class="filter-select">
                    <option value="">ëª¨ë“  íƒ€ì…</option>
                    <option value="CODE">ì½”ë“œ</option>
                    <option value="TEXT">í…ìŠ¤íŠ¸</option>
                    <option value="IMG">ì´ë¯¸ì§€</option>
                </select>
            </div>
        </div>

        <!-- ë¶ë§ˆí¬ ëª©ë¡ì„ ìŠ¤ë‹ˆí« ì¹´ë“œ í˜•íƒœë¡œ ë³€ê²½ -->
        <div th:if="${userId != null}">
            <!-- ë¶ë§ˆí¬ ëª©ë¡ì„ ë™ì ìœ¼ë¡œ ë¡œë“œí•  ì»¨í…Œì´ë„ˆ -->
            <div id="snippetSectionContainer"></div>

            <!-- ë¡œë”© ìƒíƒœ -->
            <div id="bookmarkLoadingState" class="loading-text">
                ë¶ë§ˆí¬ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
            </div>

            <!-- ë¶ë§ˆí¬ê°€ ì—†ëŠ” ê²½ìš° -->
            <div th:if="${#lists.isEmpty(bookmarks)}" class="empty-state">
                <div class="emoji">ğŸŒŸ</div>
                <p>ì•„ì§ ë¶ë§ˆí¬í•œ ìŠ¤ë‹ˆí«ì´ ì—†ìŠµë‹ˆë‹¤</p>
                <p>ë§ˆìŒì— ë“œëŠ” ìŠ¤ë‹ˆí«ì„ ë¶ë§ˆí¬í•˜ì—¬ ë‚˜ì¤‘ì— ì‰½ê²Œ ì°¾ì•„ë³´ì„¸ìš”!</p>
                <a th:href="@{/snippets}" class="btn btn-primary">
                    <i class="fas fa-search"></i> ìŠ¤ë‹ˆí« ë‘˜ëŸ¬ë³´ê¸°
                </a>
            </div>
        </div>

        <!-- ë¡œê·¸ì¸í•˜ì§€ ì•Šì€ ê²½ìš° ë¹ˆ ìƒíƒœ ë©”ì‹œì§€ -->
        <div th:if="${userId == null}" class="empty-state">
            <div class="emoji">ğŸ”’</div>
            <h3>ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤</h3>
            <p>ë¶ë§ˆí¬ë¥¼ í™•ì¸í•˜ë ¤ë©´ ë¨¼ì € ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.</p>
            <a href="/login" class="btn btn-primary">
                <i class="fas fa-sign-in-alt"></i> ë¡œê·¸ì¸í•˜ê¸°
            </a>
        </div>
    </div>
</main>

<!-- ìŠ¤ë‹ˆí« ìƒì„¸ë³´ê¸° ëª¨ë‹¬ í¬í•¨ -->
<div th:replace="snippet-section/snippet-section :: snippetModal"></div>

<!-- ì „ì—­ ë³€ìˆ˜ ì„¤ì • (ê°€ì¥ ë¨¼ì €) -->
<script th:inline="javascript">
    const userId = /*[[${userId}]]*/ null;
    const message = /*[[${message}]]*/ null;
    const error = /*[[${error}]]*/ null;

    // ë¶ë§ˆí¬ ë°ì´í„°ë¥¼ ì „ì—­ ë³€ìˆ˜ë¡œ ì„¤ì •
    const bookmarkData = /*[[${bookmarks}]]*/ [];

    console.log('í˜„ì¬ ì‚¬ìš©ì ID:', userId);
    console.log('ë¶ë§ˆí¬ ê°œìˆ˜:', /*[[${count}]]*/ 0);
    console.log('ë¶ë§ˆí¬ ë°ì´í„°:', bookmarkData);
</script>

<!-- ë¶„ë¦¬ëœ JavaScript íŒŒì¼ë“¤ (ìˆœì„œ ì¤‘ìš”!) -->
<script th:src="@{/snippet-section/js/snippet-modal-main.js}"></script>
<!--<script th:src="@{/snippet-section/js/snippet-tags.js}"></script>-->
<script th:src="@{/snippet-section/js/snippet-actions.js}"></script>
<script th:src="@{/bookmark/js/bookmark-list.js}"></script>
<script th:src="@{/bookmark/js/bookmark-dynamic-loader.js}"></script>
<style>
/*ìŠ¤íƒ€ì¼ ì¡°ì • */
.snippet-card {
position: relative;
cursor: pointer;
transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.snippet-card:hover {
transform: translateY(-2px);
box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.snippet-card.has-color {
background: linear-gradient(135deg, rgba(255,255,255,0.9) 0%, rgba(255,255,255,0.95) 100%);
padding-left: 50px; /* ë¶ë§ˆí¬ ì œê±° ë²„íŠ¼ ê³µê°„ í™•ë³´ */
}

.color-indicator {
/* snippet-section.cssì—ì„œ ì´ë¯¸ ì •ì˜ë¨ - ì¤‘ë³µ ì œê±° */
}

.more-indicator {
text-align: center;
color: #666;
font-size: 0.9em;
margin-top: 10px;
opacity: 0.7;
}

/* ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸° ìŠ¤íƒ€ì¼ */
.image-container {
text-align: center;
margin-bottom: 8px;
}

.preview-image {
max-width: 100%;
max-height: 150px;
border-radius: 4px;
object-fit: cover;
}

.image-error {
padding: 20px;
text-align: center;
background: #f5f5f5;
border-radius: 4px;
color: #666;
}

/* ë©”ì¸ ì»¨í…ì¸  ì¡°ì • */
.main-content .container {
max-width: none;
padding: 20px;
}

/* ê²€ìƒ‰ í•„í„°ë§ ê´€ë ¨ ìŠ¤íƒ€ì¼ */
.search-section {
margin-bottom: 20px;
}

.search-bar {
display: flex;
gap: 10px;
align-items: center;
}

.search-input {
flex: 1;
padding: 10px;
border: 1px solid #ddd;
border-radius: 4px;
}

.filter-select {
padding: 10px;
border: 1px solid #ddd;
border-radius: 4px;
background: white;
}
/* ë¶ë§ˆí¬ ì œê±° ë²„íŠ¼ ìŠ¤íƒ€ì¼ - ì¢Œìƒë‹¨ìœ¼ë¡œ ì´ë™ */
.bookmark-remove-btn {
    position: absolute;
    top: 10px;
    left: 10px;
    background: #dc3545;
    color: white;
    border: none;
    border-radius: 50%;
    width: 30px;
    height: 30px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    opacity: 0.8;
    transition: all 0.2s;
    z-index: 1000;
    box-shadow: 0 2px 6px rgba(0,0,0,0.15);
}

.bookmark-remove-btn:hover {
    opacity: 1;
    background: #c82333;
    transform: scale(1.1);
}

/* ìƒ‰ìƒ ì¸ë””ì¼€ì´í„°ê°€ ìˆëŠ” ê²½ìš° ë¶ë§ˆí¬ ì œê±° ë²„íŠ¼ ìœ„ì¹˜ ì¡°ì • */
.snippet-card.has-color .bookmark-remove-btn {
    top: 45px; /* ìƒ‰ìƒ ì¸ë””ì¼€ì´í„° ì•„ë˜ë¡œ ì´ë™ */
}
</style>

</body>
</html>